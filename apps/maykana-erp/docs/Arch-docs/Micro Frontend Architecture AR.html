<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Micro-Frontend Architecture - ERP Platform</title>
    <style>
      :root {
        --bg: #f5f7fb;
        --card: #ffffff;
        --text: #1f2937;
        --muted: #6b7280;
        --line: #e5e7eb;
        --primary: #0f766e;
        --primary-soft: #ecfdf5;
        --accent: #1d4ed8;
        --accent-soft: #eff6ff;
        --warn: #b45309;
        --warn-soft: #fffbeb;
        --danger: #b91c1c;
        --danger-soft: #fef2f2;
        --radius: 14px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: 'Segoe UI', 'Arabic Typesetting', 'Arial', 'Tahoma', sans-serif;
        background: radial-gradient(
          1200px 800px at 100% 0%,
          #eef7ff 0%,
          var(--bg) 46%,
          #f2f4f8 100%
        );
        color: var(--text);
        line-height: 1.8;
        padding: 24px;
        direction: rtl;
        text-align: right;
      }

      .container {
        max-width: 1220px;
        margin: 0 auto;
        display: grid;
        gap: 14px;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: var(--radius);
        padding: 20px;
        box-shadow: 0 4px 12px rgba(16, 24, 40, 0.04);
      }

      .hero {
        background: linear-gradient(180deg, #ffffff 0%, #f9f5ff 100%);
        border-color: #c7d2fe;
      }

      .hero h1 {
        margin: 0 0 8px;
        font-size: 32px;
        line-height: 1.3;
        color: var(--primary);
      }

      h2 {
        margin: 0 0 12px;
        font-size: 24px;
        color: var(--primary);
        border-bottom: 2px solid var(--primary-soft);
        padding-bottom: 8px;
      }

      h3 {
        margin: 16px 0 8px;
        font-size: 18px;
        color: #111827;
      }

      h4 {
        margin: 12px 0 6px;
        font-size: 16px;
        color: #1f2937;
      }

      p {
        margin: 0 0 10px;
      }

      .muted {
        color: var(--muted);
        font-size: 14px;
      }

      .pill {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        margin-left: 6px;
        margin-bottom: 10px;
        border: 1px solid transparent;
      }

      .pill.primary {
        background: var(--primary-soft);
        color: var(--primary);
        border-color: #99f6e4;
      }
      .pill.accent {
        background: var(--accent-soft);
        color: var(--accent);
        border-color: #bfdbfe;
      }
      .pill.warn {
        background: var(--warn-soft);
        color: var(--warn);
        border-color: #fde68a;
      }

      .toc {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
      }

      .toc a {
        display: block;
        text-decoration: none;
        color: #0b3c8a;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 13px;
        transition: all 0.2s ease;
        text-align: right;
      }

      .toc a:hover {
        background: #eff6ff;
        border-color: var(--primary);
        color: var(--primary);
      }

      ul, ol {
        margin: 0 0 10px;
        padding-right: 24px;
        text-align: right;
      }

      li {
        margin: 6px 0;
      }

      .grid-2 {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 12px;
      }

      .grid-3 {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 12px;
      }

      .box {
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        padding: 12px;
        background: #fcfcfd;
        text-align: right;
      }

      .box h4 {
        margin: 0 0 8px;
      }

      .box ul {
        margin: 0;
        padding-right: 20px;
      }

      .box li {
        margin: 4px 0;
        font-size: 14px;
      }

      .highlight {
        border-right: 4px solid var(--primary);
        background: #f0fdf4;
        border-radius: 8px;
        padding: 12px 14px;
        margin: 10px 0;
        text-align: right;
      }

      .highlight.info {
        border-right-color: var(--accent);
        background: #f0f9ff;
      }

      .highlight.warning {
        border-right-color: #ef6444;
        background: #fef2f2;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
        margin: 10px 0;
      }

      th, td {
        border: 1px solid var(--line);
        padding: 10px 12px;
        text-align: right;
        background: #fff;
      }

      th {
        background: #f3f4f6;
        font-weight: 600;
        color: #1f2937;
      }

      code {
        background: #f3f4f6;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        padding: 2px 6px;
        font-family: 'Courier New', monospace;
        font-size: 13px;
        color: #c4161c;
        direction: ltr;
      }

      a {
        color: var(--accent);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      pre {
        direction: ltr;
        text-align: left;
        background: #f3f4f6;
        padding: 12px;
        border-radius: 8px;
        overflow-x: auto;
        font-size: 12px;
      }

      strong {
        color: #0f766e;
      }
    </style>
  </head>
  <body>
    <main class="container">
      <!-- Hero Section -->
      <section class="card hero" id="top">
        <span class="pill primary">Enterprise Architecture</span>
        <span class="pill accent">ERP Platform</span>
        <span class="pill warn">Micro-Frontend Pattern</span>
        <h1>Micro-Frontend Architecture</h1>
        <p>
          دليل شامل لتطبيق معمارية <strong>Micro-Frontend</strong> قابلة للتوسع على مستوى المؤسسات
          لمنصات <strong>ERP</strong> على نطاق واسع مع وحدات مجالات مستقلة.
        </p>
        <p class="muted">
          يوضح هذا المستند مبادئ المعمارية وأنماط تنسيق <strong>Shell</strong> والتصميم المبني على وحدات من <strong>Micro-Frontends</strong>
          لأنظمة مثل <strong>HR</strong> و <strong>Inventory</strong> و <strong>Sales</strong> و <strong>Finance</strong> و <strong>Procurement</strong> و <strong>CRM</strong> والتقارير.
        </p>
      </section>

      <!-- Table of Contents -->
      <section class="card" id="state">
        <h2>المحتويات</h2>
        <div class="toc">
          <a href="#intro">1) المقدمة</a>
          <a href="#components">2) المكونات الرئيسية</a>
          <a href="#host">3) Host Application (Shell)</a>
          <a href="#ownership">3.2) Shell vs MFEs</a>
          <a href="#layout">3.3) Global Layout</a>
          <a href="#navigation">3.4) Navigation & Menu</a>
          <a href="#auth">3.5) Authentication</a>
          <a href="#permissions">3.6) Permissions</a>
          <a href="#providers">3.7) Global Providers</a>
          <a href="#lifecycle">3.8) MFE Lifecycle</a>
          <a href="#fallback">3.9) Error Boundaries</a>
          <a href="#contract">3.10) Integration Contract</a>
          <a href="#flow">3.11) Example: ERP Flow</a>
          <a href="#mfes">4) Domain Micro-Frontends</a>
          <a href="#clean-arch">5) Clean Architecture</a>
          <a href="#state-mgmt">6) State Management Pattern</a>
          <a href="#error-strategy">7) Error Handling Strategy</a>
          <a href="#best-practices">8) Best Practices</a>
          <a href="#performance">9) Performance Optimization</a>
        </div>
      </section>

      <!-- 1. Introduction -->
      <section class="card" id="intro">
        <h2>1) المقدمة</h2>
        <p>
          توضح هذه المعمارية نهج <strong>Micro-Frontend</strong> لدعم منصة على نطاق واسع
          مع عدة مجالات عمل ووحدات تتطور بشكل مستقل. وهي مصممة لسيناريوهات المؤسسات
          مثل أنظمة <strong>ERP</strong> حيث تتضمن المنصة وحدات مثل <strong>HR</strong> و <strong>Inventory</strong>
          و <strong>Sales</strong> و <strong>Finance</strong> والمشتريات وإدارة علاقات العملاء والتقارير، مع الحفاظ على تجربة مستخدم موحدة.
        </p>
        <p>
          تتكون المنصة من <strong>Host Application (Shell)</strong> مركزي و
          <strong>عدة Micro-Frontends مبنية على أساس المجالات</strong>. يعمل <strong>Shell</strong> كنقطة دخول رئيسية
          وطبقة تنسيق، مسؤول عن إطار التطبيق المشترك والملاحة والتخطيط والسياق العام. يتم تطبيق كل وحدة مجال ك <strong>MFE</strong> مستقلة
          (مثل MFE-HR و MFE-Inventory و MFE-Sales و MFE-Finance).
        </p>

        <h3>المبادئ الأساسية</h3>
        <ul>
          <li>
            <strong>Clean Architecture:</strong> تفصل كل MFE منطق المجال وتطبيق التدفق
            والبنية التحتية وطبقات العرض.
          </li>
          <li>
            <strong>Atomic Design:</strong> نظام تصميم مشترك مع UI components قابلة لإعادة الاستخدام عبر جميع الوحدات.
          </li>
          <li>
            <strong>Modular Ownership:</strong> حدود مجالات واضحة تمكن التطوير المستقل والاختبار والنشر.
          </li>
          <li>
            <strong>Consistent Experience:</strong> إطار منصة موحد والمصادقة والمزودين ورموز التصميم والمعايير.
          </li>
          <li>
            <strong>Resilience:</strong> فشل إحدى الوحدات لا يؤدي إلى توقف المنصة بأكملها—Shell يحافظ على الإطار ويوفر UI بديلة.
          </li>
        </ul>

        <div class="highlight">
          <strong>الهدف:</strong> تمكين ERP Frontend من التوسع بطريقة منضبطة وقابلة للصيانة
          من خلال الجمع بين modular domain ownership والمعايير المشتركة للمنصة
          والـ clean architecture المستقلة داخل كل وحدة.
        </div>
      </section>

      <!-- 2. Key Components -->
      <section class="card" id="components">
        <h2>2) المكونات الرئيسية</h2>
        
        <h3>Platform Architecture Diagram</h3>
        <svg viewBox="0 0 1000 600" style="width: 100%; max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;">
          <defs>
            <marker id="archArrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#2563eb"/>
            </marker>
          </defs>

          <rect x="20" y="20" width="960" height="560" fill="#ecfdf5" stroke="#0f766e" stroke-width="2" rx="10"/>
          <text x="500" y="48" font-size="16" font-weight="bold" text-anchor="middle" fill="#0f766e">Host Application (Shell)</text>

          <rect x="40" y="65" width="920" height="50" fill="#0f766e" stroke="#0f766e" stroke-width="1" rx="6"/>
          <text x="500" y="95" font-size="12" font-weight="bold" text-anchor="middle" fill="white">Header: Branding | User Profile | Notifications | Language Switcher</text>

          <rect x="40" y="130" width="230" height="360" fill="#d1fae5" stroke="#0f766e" stroke-width="1.5" rx="6"/>
          <text x="155" y="155" font-size="13" font-weight="bold" text-anchor="middle" fill="#0f766e">Navigation</text>
          <text x="155" y="180" font-size="11" text-anchor="middle" fill="#065f46">HR</text>
          <text x="155" y="200" font-size="11" text-anchor="middle" fill="#065f46">Inventory</text>
          <text x="155" y="220" font-size="11" text-anchor="middle" fill="#065f46">Sales</text>
          <text x="155" y="240" font-size="11" text-anchor="middle" fill="#065f46">Finance</text>
          <text x="155" y="260" font-size="11" text-anchor="middle" fill="#065f46">Procurement</text>
          <text x="155" y="280" font-size="11" text-anchor="middle" fill="#065f46">CRM</text>
          <text x="155" y="300" font-size="11" text-anchor="middle" fill="#065f46">Reporting</text>

          <rect x="285" y="130" width="495" height="360" fill="#fffbeb" stroke="#b45309" stroke-width="1.5" rx="6"/>
          <text x="532" y="155" font-size="13" font-weight="bold" text-anchor="middle" fill="#b45309">Workspace (Active Module)</text>

          <rect x="305" y="180" width="220" height="130" fill="#fff7ed" stroke="#ea580c" stroke-width="1.5" rx="6"/>
          <text x="415" y="205" font-size="12" font-weight="bold" text-anchor="middle" fill="#9a3412">MFE-Inventory</text>
          <text x="415" y="228" font-size="10" text-anchor="middle" fill="#6b7280">Routes: /inventory/*</text>
          <text x="415" y="246" font-size="10" text-anchor="middle" fill="#6b7280">Pages: Items | Warehouses | Transfers</text>
          <text x="415" y="264" font-size="10" text-anchor="middle" fill="#6b7280">State + Domain Adapters</text>

          <rect x="540" y="180" width="220" height="130" fill="#fef2f2" stroke="#b91c1c" stroke-width="1.5" rx="6"/>
          <text x="650" y="205" font-size="12" font-weight="bold" text-anchor="middle" fill="#b91c1c">MFE-Sales</text>
          <text x="650" y="228" font-size="10" text-anchor="middle" fill="#6b7280">Routes: /sales/*</text>
          <text x="650" y="246" font-size="10" text-anchor="middle" fill="#6b7280">Orders | Quotations | Invoices</text>
          <text x="650" y="264" font-size="10" text-anchor="middle" fill="#6b7280">State + Domain Adapters</text>

          <rect x="305" y="325" width="455" height="145" fill="#eef2ff" stroke="#4f46e5" stroke-width="1.5" rx="6"/>
          <text x="532" y="348" font-size="12" font-weight="bold" text-anchor="middle" fill="#4338ca">Shared Platform Services</text>
          <text x="532" y="370" font-size="10" text-anchor="middle" fill="#6b7280">Theme | i18n | Auth/Session | Tenant | Telemetry</text>
          <text x="532" y="390" font-size="10" text-anchor="middle" fill="#6b7280">Routing Helpers | Error Boundaries | Notifications</text>

          <line x1="270" y1="230" x2="305" y2="230" stroke="#2563eb" stroke-width="2" marker-end="url(#archArrow)"/>
          <line x1="270" y1="260" x2="305" y2="260" stroke="#2563eb" stroke-width="2" marker-end="url(#archArrow)"/>
          <text x="280" y="220" font-size="9" fill="#2563eb">Route</text>
          <text x="280" y="275" font-size="9" fill="#2563eb">Mount</text>

          <line x1="415" y1="325" x2="415" y2="312" stroke="#2563eb" stroke-width="2" marker-end="url(#archArrow)"/>
          <line x1="650" y1="325" x2="650" y2="312" stroke="#2563eb" stroke-width="2" marker-end="url(#archArrow)"/>
          <text x="532" y="320" font-size="9" text-anchor="middle" fill="#2563eb">Platform Context Injection</text>

          <rect x="40" y="505" width="920" height="55" fill="#f3f4f6" stroke="#d1d5db" stroke-width="1" rx="6"/>
          <text x="500" y="538" font-size="11" text-anchor="middle" fill="#4b5563">Footer: Support Links | Environment Info | Version</text>
        </svg>

        <h3>هيكل المنصة</h3>
        <div class="grid-3">
          <div class="box">
            <h4>Host Application (Shell)</h4>
            <ul>
              <li>Central orchestration layer</li>
              <li>Platform entry point</li>
              <li>Module discovery & loading</li>
              <li>Global layout & navigation</li>
              <li>Auth & session bootstrap</li>
              <li>Shared providers hosting</li>
            </ul>
          </div>
          <div class="box">
            <h4>Domain Micro-Frontends</h4>
            <ul>
              <li>MFE-HR</li>
              <li>MFE-Inventory</li>
              <li>MFE-Sales</li>
              <li>MFE-Finance</li>
              <li>MFE-Procurement</li>
              <li>MFE-CRM & Reporting</li>
            </ul>
          </div>
          <div class="box">
            <h4>Shared Foundations</h4>
            <ul>
              <li>Atomic Design System</li>
              <li>Shared UI Components</li>
              <li>Common Utilities</li>
              <li>API Integration Base</li>
              <li>Auth/Session Helpers</li>
              <li>Telemetry & Logging</li>
            </ul>
          </div>
        </div>

        <h3>طبقات المعمارية</h3>
        <ul>
          <li><strong>Micro-Frontend Registration Contract:</strong> Manifest-based module discovery</li>
          <li><strong>Routing & Navigation Model:</strong> Shell ينسق top-level routes</li>
          <li><strong>Integration & Communication:</strong> Typed contracts للـ stable coupling</li>
          <li><strong>Observability & Error Handling:</strong> Centralized logging والمرونة</li>
        </ul>
      </section>

      <!-- 3. Host Application (Shell) -->
      <section class="card" id="host">
        <h2>3) Host Application (Shell)</h2>
        <p>
          <strong>Host Application (Shell)</strong> هو نقطة الدخول المركزية وطبقة التنسيق
          لجميع <strong>Micro-Frontends</strong>. يوفر إطار التطبيق المشترك وينسق كيفية اكتشاف الوحدات
          وتحميلها وتقديمها للمستخدم.
        </p>
        <p>
          يؤسس Shell تجربة منصة متسقة عبر جميع الوحدات بينما يسمح لكل MFE
          بالبقاء مستقلة في التطبيق والتطور.
        </p>

        <h3>المسؤوليات الأساسية</h3>
        <ul>
          <li>توفير التخطيط والإطار الشامل للتطبيق</li>
          <li>إدارة الملاحة من المستوى الأعلى وتنسيق القائمة</li>
          <li>تهيئة المصادقة وسياق جلسة المستخدم</li>
          <li>تطبيق الرؤية المستندة إلى الأذونات والوصول إلى الوحدات</li>
          <li>تسجيل وتحميل الـ Micro-Frontends ديناميكياً</li>
          <li>توفير المزودين العموميين المشتركين (Theme و Localization و Tenant Context و Telemetry)</li>
          <li>معالجة Error Boundaries العموميين والسلوك البديل</li>
          <li>كشف Integration Contract مستقر للـ Micro-Frontends</li>
        </ul>
      </section>

      <!-- 3.2 Ownership -->
      <section class="card" id="ownership">
        <h2>3.2) Shell vs MFEs - توزيع الملكية</h2>
        
        <svg viewBox="0 0 1000 400" style="width: 100%; max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;">
          <!-- Shell Section -->
          <rect x="30" y="30" width="420" height="340" fill="#ecfdf5" stroke="#0f766e" stroke-width="2" rx="8"/>
          <text x="240" y="60" font-size="16" font-weight="bold" text-anchor="middle" fill="#0f766e">Shell Keeps</text>
          
          <rect x="50" y="80" width="380" height="30" fill="#d1fae5" stroke="#0f766e" stroke-width="1" rx="4"/>
          <text x="240" y="100" font-size="11" text-anchor="middle" fill="#0f766e">• Platform Entry Point</text>
          
          <rect x="50" y="120" width="380" height="30" fill="#d1fae5" stroke="#0f766e" stroke-width="1" rx="4"/>
          <text x="240" y="140" font-size="11" text-anchor="middle" fill="#0f766e">• Global Layout (Header, Sidebar)</text>
          
          <rect x="50" y="160" width="380" height="30" fill="#d1fae5" stroke="#0f766e" stroke-width="1" rx="4"/>
          <text x="240" y="180" font-size="11" text-anchor="middle" fill="#0f766e">• Top-level Routing</text>
          
          <rect x="50" y="200" width="380" height="30" fill="#d1fae5" stroke="#0f766e" stroke-width="1" rx="4"/>
          <text x="240" y="220" font-size="11" text-anchor="middle" fill="#0f766e">• Auth Bootstrap & Permissions</text>
          
          <rect x="50" y="240" width="380" height="30" fill="#d1fae5" stroke="#0f766e" stroke-width="1" rx="4"/>
          <text x="240" y="260" font-size="11" text-anchor="middle" fill="#0f766e">• Shared Providers</text>
          
          <rect x="50" y="280" width="380" height="30" fill="#d1fae5" stroke="#0f766e" stroke-width="1" rx="4"/>
          <text x="240" y="300" font-size="11" text-anchor="middle" fill="#0f766e">• MFE Orchestration & Loading</text>
          
          <!-- MFE Section -->
          <rect x="520" y="30" width="420" height="340" fill="#fef2f2" stroke="#b91c1c" stroke-width="2" rx="8"/>
          <text x="730" y="60" font-size="16" font-weight="bold" text-anchor="middle" fill="#b91c1c">MFE Owns</text>
          
          <rect x="540" y="80" width="380" height="30" fill="#fee2e2" stroke="#b91c1c" stroke-width="1" rx="4"/>
          <text x="730" y="100" font-size="11" text-anchor="middle" fill="#b91c1c">• Domain-Specific Pages</text>
          
          <rect x="540" y="120" width="380" height="30" fill="#fee2e2" stroke="#b91c1c" stroke-width="1" rx="4"/>
          <text x="730" y="140" font-size="11" text-anchor="middle" fill="#b91c1c">• Internal Routing (/module/*)</text>
          
          <rect x="540" y="160" width="380" height="30" fill="#fee2e2" stroke="#b91c1c" stroke-width="1" rx="4"/>
          <text x="730" y="180" font-size="11" text-anchor="middle" fill="#b91c1c">• Domain Business Logic</text>
          
          <rect x="540" y="200" width="380" height="30" fill="#fee2e2" stroke="#b91c1c" stroke-width="1" rx="4"/>
          <text x="730" y="220" font-size="11" text-anchor="middle" fill="#b91c1c">• API Integration Adapters</text>
          
          <rect x="540" y="240" width="380" height="30" fill="#fee2e2" stroke="#b91c1c" stroke-width="1" rx="4"/>
          <text x="730" y="260" font-size="11" text-anchor="middle" fill="#b91c1c">• Local State Management</text>
          
          <rect x="540" y="280" width="380" height="30" fill="#fee2e2" stroke="#b91c1c" stroke-width="1" rx="4"/>
          <text x="730" y="300" font-size="11" text-anchor="middle" fill="#b91c1c">• Module Telemetry Events</text>
        </svg>

        <div class="grid-2">
          <div class="box">
            <h4>Shell Owns</h4>
            <ul>
              <li>Platform entry point</li>
              <li>Global layout (header, sidebar, workspace)</li>
              <li>Top-level routing</li>
              <li>Global navigation/menu rendering</li>
              <li>Auth bootstrap & session init</li>
              <li>Permission-based visibility</li>
              <li>Shared providers & context</li>
              <li>MFE discovery & orchestration</li>
              <li>Global error boundaries</li>
              <li>Platform-level telemetry</li>
            </ul>
          </div>
          <div class="box">
            <h4>Each MFE Owns</h4>
            <ul>
              <li>Domain-specific pages & workflows</li>
              <li>Internal routing under base path</li>
              <li>Domain UI components</li>
              <li>Feature state & interactions</li>
              <li>Domain validation & logic</li>
              <li>Backend integration adapters</li>
              <li>Local error handling</li>
              <li>Module telemetry events</li>
            </ul>
          </div>
        </div>

        <div class="highlight">
          <strong>قاعدة الحدود:</strong> Shell يملك إطار المنصة والتنسيق؛ MFEs تملك تجربة المجال
          داخل حدود وحدتها.
        </div>
      </section>

      <!-- 3.3 Global Layout -->
      <section class="card" id="layout">
        <h2>3.3) Global Layout (Header / Sidebar / Footer)</h2>
        <p>
          يوفر Shell هيكل التخطيط المشترك الذي تستخدمه جميع الوحدات لضمان تجربة مستخدم موحدة
          ومظهر مرئي متسق عبر المنصة.
        </p>

        <h3>مناطق التخطيط النموذجية</h3>

        <h4>Header</h4>
        <ul>
          <li>Platform branding/logo</li>
          <li>User profile/session actions</li>
          <li>Notifications entry point</li>
          <li>Language switcher</li>
          <li>Tenant/company selector</li>
        </ul>

        <h4>Sidebar / Left Navigation</h4>
        <ul>
          <li>Main module navigation (HR, Inventory, Sales, Finance, etc.)</li>
          <li>Grouped navigation sections</li>
          <li>Permission-aware menu items</li>
          <li>Collapsible behavior (optional)</li>
        </ul>

        <h4>Footer</h4>
        <ul>
          <li>Environment/version indicators</li>
          <li>Support/help links</li>
          <li>Product information</li>
        </ul>

        <h4>Workspace / Content Area</h4>
        <ul>
          <li>Main rendering area where active MFE is mounted</li>
          <li>Page-level Shell wrappers (breadcrumbs, title zones)</li>
          <li>Loading/fallback state rendering</li>
        </ul>
      </section>

      <!-- 3.4 Navigation -->
      <section class="card" id="navigation">
        <h2>3.4) Global Navigation and Menu Orchestration</h2>
        <p>
          Shell مسؤول عن تنسيق الملاحة العامة وبناء قائمة المنصة من خلال الجمع بين
          إعدادات Shell وإعلانات Manifest من MFEs.
        </p>

        <h3>Shell Responsibilities</h3>
        <ul>
          <li>حل الوحدات المتاحة من بيانات التسجيل / Manifest</li>
          <li>بناء هيكل الملاحة Sidebar / Top Navigation</li>
          <li>تطبيق قواعد الترتيب والتجميع</li>
          <li>تطبيق Feature Flags (إن كانت مفعلة / معطلة)</li>
          <li>تصفية عناصر القائمة بناءً على أذونات / مطالبات المستخدم</li>
          <li>توجيه المستخدمين إلى مسار قاعدة الوحدة المحددة</li>
        </ul>

        <h3>Menu Source Strategy</h3>
        <p>يجب إنشاء القائمة من مزيج من:</p>
        <ul>
          <li><strong>Shell Configuration:</strong> Groups,ordering, platform rules</li>
          <li><strong>MFE Manifests:</strong> Module metadata, route, display name, icon, permissions</li>
        </ul>

        <div class="highlight info">
          <strong>Best Practice:</strong> Shell يعرض القائمة؛ MFEs توفر Manifest metadata وليس direct menu rendering logic.
        </div>
      </section>

      <!-- 3.5 Authentication -->
      <section class="card" id="auth">
        <h2>3.5) Authentication / Session Bootstrap</h2>
        <p>
          يقوم Shell بعملية المصادقة الأولية وتمهيد الجلسة قبل تحميل الوحدات المحمية.
        </p>

        <h3>Shell Responsibilities</h3>
        <ul>
          <li>الكشف عن حالة المصادقة (authenticated / unauthenticated)</li>
          <li>تفعيل تدفق تسجيل الدخول أو إعادة التوجيه إلى identity provider</li>
          <li>استرجاع وتهيئة سياق الجلسة (tokens، profile، tenant/company)</li>
          <li>تهيئة مطالبات / أذونات المستخدم</li>
          <li>معالجة دورة حياة Token Refresh</li>
          <li>كشف سياق Auth/Session إلى MFEs من خلال shared providers</li>
        </ul>

        <h3>Expected Outcome Before MFE Mount</h3>
        <p>يجب على Shell أن يؤسس:</p>
        <ul>
          <li>Authenticated user identity</li>
          <li>Current tenant/company/branch context</li>
          <li>Permission/role claims</li>
          <li>Locale/language preferences</li>
          <li>Global telemetry correlation context</li>
        </ul>

        <div class="highlight">
          هذا يضمن بدء جميع الوحدات بسياق منصة متسق وموثوق.
        </div>
      </section>

      <!-- 3.6 Permissions -->
      <section class="card" id="permissions">
        <h2>3.6) Permission-Based Module Visibility</h2>
        <p>
          يتحكم Shell في الوحدات وإدخالات الملاحة التي تكون مرئية وقابلة للوصول بناءً على
          أذونات أو أدوار أو مطالبات المستخدم.
        </p>

        <h3>Shell Responsibilities</h3>
        <ul>
          <li>تقييم Permissions لكل وحدة مسجلة</li>
          <li>إخفاء أو تعطيل الوحدات غير المتاحة في القائمة</li>
          <li>منع التنقل إلى مسارات الوحدات غير المصرح بها</li>
          <li>عرض Fallback screens / رسائل عند الحاجة</li>
          <li>تمرير Permission context إلى MFEs (إن لزم الأمر)</li>
        </ul>

        <div class="highlight warning">
          <strong>Security Rule:</strong> Permission Checks في Shell تحسن UX والتحكم في الملاحة،
          لكنها لا تحل محل Backend Authorization. خدمات Backend هي مصدر الحقيقة للتحكم في الوصول.
        </div>
      </section>

      <!-- 3.7 Providers -->
      <section class="card" id="providers">
        <h2>3.7) Global Providers (Theme, i18n, Tenant, Telemetry)</h2>
        <p>
          يقوم Shell بتهيئة واستضافة مزودي خدمات عموميين يجب مشاركتهم بشكل متسق
          عبر جميع Micro-Frontends.
        </p>

        <table>
          <thead>
            <tr>
              <th>المزود</th>
              <th>يوفر</th>
              <th>التأثير على MFEs</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Theme Provider</strong></td>
              <td>Design tokens, light/dark mode, UI density settings</td>
              <td>Consistent visual appearance across all modules</td>
            </tr>
            <tr>
              <td><strong>Localization (i18n)</strong></td>
              <td>Language selection, locale formatting, RTL/LTR support</td>
              <td>Unified language & direction across platform</td>
            </tr>
            <tr>
              <td><strong>Tenant / Company Context</strong></td>
              <td>Current tenant/company/branch, context switching</td>
              <td>All modules operate on same tenant context</td>
            </tr>
            <tr>
              <td><strong>Telemetry / Logging</strong></td>
              <td>Correlation IDs, user/session metadata</td>
              <td>Unified observability across all modules</td>
            </tr>
            <tr>
              <td><strong>Auth / Session Provider</strong></td>
              <td>User identity, claims/permissions, session status</td>
              <td>Consistent security model without re-implementation</td>
            </tr>
          </tbody>
        </table>

        <div class="highlight">
          يجب على Shell توفير هذه العناصر من خلال عقود مستقرة حتى تستهلك جميع MFEs نفس نموذج سياق المنصة
          بدلاً من إعادة تطبيقه بشكل مستقل.
        </div>
      </section>

      <!-- 3.8 Lifecycle -->
      <section class="card" id="lifecycle">
        <h2>3.8) MFE Loading / Orchestration Lifecycle</h2>
        <p>
          يدير Shell دورة حياة Micro-Frontends بالكاملة من التسجيل من خلال العرض والإلغاء.
        </p>

        <h3>MFE Loading Lifecycle Stages</h3>
        
        <svg viewBox="0 0 1000 500" style="width: 100%; max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;">
          <!-- Timeline boxes -->
          <g font-size="11" font-family="Arial, sans-serif">
            
            <!-- Step 1 -->
            <circle cx="100" cy="150" r="25" fill="#0f766e" stroke="#0f766e" stroke-width="2"/>
            <text x="100" y="155" font-size="12" font-weight="bold" text-anchor="middle" fill="white">1</text>
            <rect x="60" y="190" width="80" height="50" fill="#ecfdf5" stroke="#0f766e" stroke-width="1" rx="4"/>
            <text x="100" y="210" font-size="10" text-anchor="middle" fill="#0f766e">Initialize</text>
            <text x="100" y="225" font-size="10" text-anchor="middle" fill="#0f766e">Shell</text>
            
            <!-- Arrow -->
            <line x1="150" y1="150" x2="220" y2="150" stroke="#999" stroke-width="2" marker-end="url(#arrowhead)"/>
            
            <!-- Step 2 -->
            <circle cx="280" cy="150" r="25" fill="#0f766e" stroke="#0f766e" stroke-width="2"/>
            <text x="280" y="155" font-size="12" font-weight="bold" text-anchor="middle" fill="white">2</text>
            <rect x="240" y="190" width="80" height="50" fill="#ecfdf5" stroke="#0f766e" stroke-width="1" rx="4"/>
            <text x="280" y="210" font-size="10" text-anchor="middle" fill="#0f766e">Bootstrap</text>
            <text x="280" y="225" font-size="10" text-anchor="middle" fill="#0f766e">Providers</text>
            
            <!-- Arrow -->
            <line x1="330" y1="150" x2="400" y2="150" stroke="#999" stroke-width="2" marker-end="url(#arrowhead)"/>
            
            <!-- Step 3 -->
            <circle cx="460" cy="150" r="25" fill="#0f766e" stroke="#0f766e" stroke-width="2"/>
            <text x="460" y="155" font-size="12" font-weight="bold" text-anchor="middle" fill="white">3</text>
            <rect x="420" y="190" width="80" height="50" fill="#ecfdf5" stroke="#0f766e" stroke-width="1" rx="4"/>
            <text x="460" y="210" font-size="10" text-anchor="middle" fill="#0f766e">Load Module</text>
            <text x="460" y="225" font-size="10" text-anchor="middle" fill="#0f766e">Registry</text>
            
            <!-- Arrow -->
            <line x1="510" y1="150" x2="580" y2="150" stroke="#999" stroke-width="2" marker-end="url(#arrowhead)"/>
            
            <!-- Step 4 -->
            <circle cx="640" cy="150" r="25" fill="#0f766e" stroke="#0f766e" stroke-width="2"/>
            <text x="640" y="155" font-size="12" font-weight="bold" text-anchor="middle" fill="white">4</text>
            <rect x="600" y="190" width="80" height="50" fill="#ecfdf5" stroke="#0f766e" stroke-width="1" rx="4"/>
            <text x="640" y="210" font-size="10" text-anchor="middle" fill="#0f766e">Build</text>
            <text x="640" y="225" font-size="10" text-anchor="middle" fill="#0f766e">Navigation</text>
            
            <!-- Arrow -->
            <line x1="690" y1="150" x2="760" y2="150" stroke="#999" stroke-width="2" marker-end="url(#arrowhead)"/>
            
            <!-- Step 5 -->
            <circle cx="820" cy="150" r="25" fill="#0f766e" stroke="#0f766e" stroke-width="2"/>
            <text x="820" y="155" font-size="12" font-weight="bold" text-anchor="middle" fill="white">5</text>
            <rect x="780" y="190" width="80" height="50" fill="#ecfdf5" stroke="#0f766e" stroke-width="1" rx="4"/>
            <text x="820" y="210" font-size="10" text-anchor="middle" fill="#0f766e">Auth User</text>
            <text x="820" y="225" font-size="10" text-anchor="middle" fill="#0f766e">&amp; Session</text>
            
            <!-- Second row -->
            <!-- Step 6 -->
            <circle cx="100" cy="350" r="25" fill="#1d4ed8" stroke="#1d4ed8" stroke-width="2"/>
            <text x="100" y="355" font-size="12" font-weight="bold" text-anchor="middle" fill="white">6</text>
            <rect x="60" y="390" width="80" height="50" fill="#eff6ff" stroke="#1d4ed8" stroke-width="1" rx="4"/>
            <text x="100" y="410" font-size="10" text-anchor="middle" fill="#1d4ed8">Resolve</text>
            <text x="100" y="425" font-size="10" text-anchor="middle" fill="#1d4ed8">Route</text>
            
            <!-- Arrow -->
            <line x1="150" y1="350" x2="220" y2="350" stroke="#999" stroke-width="2" marker-end="url(#arrowhead)"/>
            
            <!-- Step 7 -->
            <circle cx="280" cy="350" r="25" fill="#1d4ed8" stroke="#1d4ed8" stroke-width="2"/>
            <text x="280" y="355" font-size="12" font-weight="bold" text-anchor="middle" fill="white">7</text>
            <rect x="240" y="390" width="80" height="50" fill="#eff6ff" stroke="#1d4ed8" stroke-width="1" rx="4"/>
            <text x="280" y="410" font-size="10" text-anchor="middle" fill="#1d4ed8">Load</text>
            <text x="280" y="425" font-size="10" text-anchor="middle" fill="#1d4ed8">MFE Bundle</text>
            
            <!-- Arrow -->
            <line x1="330" y1="350" x2="400" y2="350" stroke="#999" stroke-width="2" marker-end="url(#arrowhead)"/>
            
            <!-- Step 8 -->
            <circle cx="460" cy="350" r="25" fill="#1d4ed8" stroke="#1d4ed8" stroke-width="2"/>
            <text x="460" y="355" font-size="12" font-weight="bold" text-anchor="middle" fill="white">8</text>
            <rect x="420" y="390" width="80" height="50" fill="#eff6ff" stroke="#1d4ed8" stroke-width="1" rx="4"/>
            <text x="460" y="410" font-size="10" text-anchor="middle" fill="#1d4ed8">Mount in</text>
            <text x="460" y="425" font-size="10" text-anchor="middle" fill="#1d4ed8">Workspace</text>
            
            <!-- Arrow -->
            <line x1="510" y1="350" x2="580" y2="350" stroke="#999" stroke-width="2" marker-end="url(#arrowhead)"/>
            
            <!-- Step 9 Success -->
            <circle cx="640" cy="350" r="25" fill="#059669" stroke="#059669" stroke-width="2"/>
            <text x="640" y="355" font-size="12" font-weight="bold" text-anchor="middle" fill="white">✓</text>
            <rect x="600" y="390" width="80" height="50" fill="#ecfdf5" stroke="#059669" stroke-width="1" rx="4"/>
            <text x="640" y="410" font-size="10" text-anchor="middle" fill="#059669">MFE</text>
            <text x="640" y="425" font-size="10" text-anchor="middle" fill="#059669">Running</text>
            
            <!-- Error path -->
            <line x1="460" y1="375" x2="460" y2="430" stroke="#b91c1c" stroke-width="2" stroke-dasharray="5,5"/>
            <circle cx="460" cy="450" r="20" fill="#fef2f2" stroke="#b91c1c" stroke-width="2"/>
            <text x="460" y="455" font-size="12" font-weight="bold" text-anchor="middle" fill="#b91c1c">✗</text>
            <text x="460" y="475" font-size="9" text-anchor="middle" fill="#b91c1c">Error Fallback</text>
          </g>
          
          <!-- Arrow marker definition -->
          <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#999"/>
            </marker>
          </defs>
        </svg>

        <h3>Concrete Lifecycle Steps</h3>
        <ol>
          <li><strong>Initialize Shell:</strong> بدء تمهيد التطبيق</li>
          <li><strong>Initialize Providers:</strong> Auth، Theme، i18n، Telemetry، Tenant</li>
          <li><strong>Load Module Registry:</strong> اكتشف MFEs المسجلة والتحقق من البيانات الوصفية</li>
          <li><strong>Build Navigation:</strong> تصفية الوحدات حسب الأذونات وعرض القائمة</li>
          <li><strong>Resolve Route:</strong> مطابقة URL الحالية لمسار قاعدة الوحدة</li>
          <li><strong>Load Target MFE:</strong> تحميل مجموعة الوحدات وتهيئة السياق</li>
          <li><strong>Mount into Workspace:</strong> حقن سياق Host وعرض الوحدة</li>
          <li><strong>Handle Runtime States:</strong> Loading, error fallback, unmount/remount</li>
          <li><strong>Track Telemetry:</strong> سجل نجاح / فشل تحميل الوحدة وأحداث الملاحة</li>
        </ol>

        <div class="highlight">
          <strong>Design Goal:</strong> يجب ألا يؤدي الفشل في MFE واحد إلى توقف المنصة بأكملها.
          يجب على Shell عزل فشل الوحدة والحفاظ على إطار المنصة.
        </div>
      </section>

      <!-- 3.9 Error Boundaries -->
      <section class="card" id="fallback">
        <h2>3.9) Error Boundaries and Fallback Behavior</h2>
        <p>
          يوفر Shell مرونة على مستوى المنصة من خلال Error Boundaries عامة وسلوكيات Fallback واضحة.
        </p>

        <h3>Shell-Level Error Handling Responsibilities</h3>
        <ul>
          <li>التقاط أخطاء runtime/rendering عند حدود كل MFE</li>
          <li>عرض شاشة fallback واضحة للمستخدم عند فشل الوحدة</li>
          <li>الحفاظ على إطار Shell والملاحة العامة دون انقطاع</li>
          <li>تسجيل تفاصيل الخطأ مع سياق الوحدة المتأثرة</li>
          <li>توفير إجراءات retry/reload عند الإمكان</li>
        </ul>

        <h3>Fallback Scenarios</h3>
        <ul>
          <li>فشل تحميل MFE bundle</li>
          <li>فشل initialization للوحدة بعد التحميل</li>
          <li>Manifest غير صالح أو ناقص الحقول الأساسية</li>
          <li>محاولة الوصول لمسار بدون صلاحية</li>
          <li>Route غير مدعوم أو Module غير موجود</li>
        </ul>
      </section>

      <!-- 3.10 Integration Contract -->
      <section class="card" id="contract">
        <h2>3.10) Shell Integration Contract with MFEs</h2>
        <p>
          يتواصل Shell وكل Micro-Frontend من خلال Integration Contract واضح ومستقر
          لمنع Tight Coupling.
        </p>

        <h3>Integration Contract Diagram</h3>
        <svg viewBox="0 0 1000 550" style="width: 100%; max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;">
          <defs>
            <marker id="contractArrowRight" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#2563eb"/>
            </marker>
            <marker id="contractArrowLeft" markerWidth="10" markerHeight="10" refX="1" refY="3" orient="auto">
              <polygon points="10 0, 0 3, 10 6" fill="#b91c1c"/>
            </marker>
          </defs>

          <rect x="30" y="30" width="940" height="490" fill="#fcfcfd" stroke="#d1d5db" stroke-width="1.5" rx="10"/>

          <rect x="55" y="60" width="330" height="420" fill="#ecfdf5" stroke="#0f766e" stroke-width="2" rx="8"/>
          <text x="220" y="90" font-size="14" font-weight="bold" text-anchor="middle" fill="#0f766e">Shell (Host)</text>

          <rect x="75" y="110" width="290" height="65" fill="#f0fdf4" stroke="#059669" stroke-width="1" rx="6"/>
          <text x="220" y="133" font-size="11" font-weight="bold" text-anchor="middle" fill="#065f46">Host Context</text>
          <text x="220" y="152" font-size="10" text-anchor="middle" fill="#4b5563">user, tenant, language, theme, telemetry</text>

          <rect x="75" y="190" width="290" height="65" fill="#f0fdf4" stroke="#059669" stroke-width="1" rx="6"/>
          <text x="220" y="213" font-size="11" font-weight="bold" text-anchor="middle" fill="#065f46">Platform Services</text>
          <text x="220" y="232" font-size="10" text-anchor="middle" fill="#4b5563">Auth, i18n, navigation, notifications</text>

          <rect x="75" y="270" width="290" height="65" fill="#f0fdf4" stroke="#059669" stroke-width="1" rx="6"/>
          <text x="220" y="293" font-size="11" font-weight="bold" text-anchor="middle" fill="#065f46">Mount + Lifecycle</text>
          <text x="220" y="312" font-size="10" text-anchor="middle" fill="#4b5563">mount, unmount, error boundary, fallback</text>

          <rect x="75" y="350" width="290" height="65" fill="#f0fdf4" stroke="#059669" stroke-width="1" rx="6"/>
          <text x="220" y="373" font-size="11" font-weight="bold" text-anchor="middle" fill="#065f46">Shell Expects</text>
          <text x="220" y="392" font-size="10" text-anchor="middle" fill="#4b5563">valid manifest + stable module contract</text>

          <rect x="615" y="60" width="330" height="420" fill="#fef2f2" stroke="#b91c1c" stroke-width="2" rx="8"/>
          <text x="780" y="90" font-size="14" font-weight="bold" text-anchor="middle" fill="#b91c1c">MFE (Domain Module)</text>

          <rect x="635" y="110" width="290" height="65" fill="#fff1f2" stroke="#ef4444" stroke-width="1" rx="6"/>
          <text x="780" y="133" font-size="11" font-weight="bold" text-anchor="middle" fill="#991b1b">Module Manifest</text>
          <text x="780" y="152" font-size="10" text-anchor="middle" fill="#4b5563">id, name, route, permissions, version</text>

          <rect x="635" y="190" width="290" height="65" fill="#fff1f2" stroke="#ef4444" stroke-width="1" rx="6"/>
          <text x="780" y="213" font-size="11" font-weight="bold" text-anchor="middle" fill="#991b1b">Module API</text>
          <text x="780" y="232" font-size="10" text-anchor="middle" fill="#4b5563">mount(), unmount(), optional update hooks</text>

          <rect x="635" y="270" width="290" height="65" fill="#fff1f2" stroke="#ef4444" stroke-width="1" rx="6"/>
          <text x="780" y="293" font-size="11" font-weight="bold" text-anchor="middle" fill="#991b1b">Runtime Behavior</text>
          <text x="780" y="312" font-size="10" text-anchor="middle" fill="#4b5563">route handling, error reporting, telemetry</text>

          <rect x="635" y="350" width="290" height="65" fill="#fff1f2" stroke="#ef4444" stroke-width="1" rx="6"/>
          <text x="780" y="373" font-size="11" font-weight="bold" text-anchor="middle" fill="#991b1b">MFE Expects</text>
          <text x="780" y="392" font-size="10" text-anchor="middle" fill="#4b5563">stable host context + platform capabilities</text>

          <rect x="420" y="120" width="160" height="300" fill="#eff6ff" stroke="#2563eb" stroke-width="1.5" rx="8" stroke-dasharray="4,4"/>
          <text x="500" y="145" font-size="12" font-weight="bold" text-anchor="middle" fill="#1d4ed8">Integration Contract</text>

          <text x="500" y="175" font-size="10" text-anchor="middle" fill="#4b5563">1) Registration</text>
          <text x="500" y="197" font-size="10" text-anchor="middle" fill="#4b5563">2) Lifecycle API</text>
          <text x="500" y="219" font-size="10" text-anchor="middle" fill="#4b5563">3) Context Injection</text>
          <text x="500" y="241" font-size="10" text-anchor="middle" fill="#4b5563">4) Routing Rules</text>
          <text x="500" y="263" font-size="10" text-anchor="middle" fill="#4b5563">5) Error Contract</text>
          <text x="500" y="285" font-size="10" text-anchor="middle" fill="#4b5563">6) Telemetry Contract</text>
          <text x="500" y="307" font-size="10" text-anchor="middle" fill="#4b5563">7) Version Compatibility</text>

          <line x1="385" y1="220" x2="420" y2="220" stroke="#2563eb" stroke-width="2" marker-end="url(#contractArrowRight)"/>
          <line x1="615" y1="310" x2="580" y2="310" stroke="#b91c1c" stroke-width="2" marker-end="url(#contractArrowLeft)"/>
          <text x="402" y="210" font-size="9" fill="#2563eb">Shell → MFE</text>
          <text x="598" y="300" font-size="9" text-anchor="end" fill="#b91c1c">MFE → Shell</text>
        </svg>

        <h3>Contract Purpose</h3>
        <p>يحدد عقد التكامل كيفية MFE:</p>
        <ul>
          <li>تسجيل نفسه (Manifest)</li>
          <li>يتم تحميله بواسطة Shell</li>
          <li>يستقبل Host/Platform Context</li>
          <li>يتفاعل مع قدرات المنصة (Navigation, Telemetry, Auth/Session)</li>
        </ul>

        <h3>Contract Areas</h3>
        <ul>
          <li>
            <strong>Registration Metadata (Manifest):</strong> module id, display name, base route, permissions, icon, version, load entry
          </li>
          <li>
            <strong>Mount / Unmount Lifecycle:</strong> كيف يقوم Shell بتثبيت MFE في Workspace
          </li>
          <li>
            <strong>Host Context:</strong> user/session context, tenant/company, theme/i18n, navigation helpers, telemetry context
          </li>
          <li>
            <strong>Optional Event Integration:</strong> Typed UI events للـ limited cross-module coordination
          </li>
        </ul>

        <div class="highlight">
          <strong>Boundary Rule:</strong> يجب أن تتكامل MFEs مع Shell فقط من خلال عقود موافق عليها
          ولا يجب أن تعتمد على جوانب Shell الداخلية.
        </div>
      </section>

      <!-- 3.11 Example Flow -->
      <section class="card" id="flow">
        <h2>3.11) Example Shell Flow (ERP Login → Menu → Module Load)</h2>
        <p>
          يوضح المثال التالي تدفق تنسيق Shell النموذجي في منصة ERP.
        </p>

        <h3>Data Flow Diagram: Request/Response Lifecycle</h3>
        <svg viewBox="0 0 1000 480" style="width: 100%; max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;">
          <!-- Browser/MFE -->
          <rect x="30" y="30" width="140" height="80" fill="#f3f4f6" stroke="#666" stroke-width="2" rx="6"/>
          <text x="100" y="60" font-size="12" font-weight="bold" text-anchor="middle">Browser</text>
          <text x="100" y="80" font-size="10" text-anchor="middle" fill="#666">MFE-Inventory</text>
          
          <!-- Shell -->
          <rect x="220" y="30" width="140" height="80" fill="#ecfdf5" stroke="#0f766e" stroke-width="2" rx="6"/>
          <text x="290" y="60" font-size="12" font-weight="bold" text-anchor="middle" fill="#0f766e">Shell</text>
          <text x="290" y="80" font-size="10" text-anchor="middle" fill="#666">Orchestration</text>
          
          <!-- Infrastructure/Adapter -->
          <rect x="410" y="30" width="140" height="80" fill="#eff6ff" stroke="#1d4ed8" stroke-width="2" rx="6"/>
          <text x="480" y="60" font-size="12" font-weight="bold" text-anchor="middle" fill="#1d4ed8">Infrastructure</text>
          <text x="480" y="80" font-size="10" text-anchor="middle" fill="#666">API Adapter</text>
          
          <!-- Backend API -->
          <rect x="600" y="30" width="140" height="80" fill="#f9f5ff" stroke="#7c3aed" stroke-width="2" rx="6"/>
          <text x="670" y="60" font-size="12" font-weight="bold" text-anchor="middle" fill="#7c3aed">Backend</text>
          <text x="670" y="80" font-size="10" text-anchor="middle" fill="#666">API Services</text>
          
          <!-- Database -->
          <rect x="790" y="30" width="140" height="80" fill="#fef2f2" stroke="#b91c1c" stroke-width="2" rx="6"/>
          <text x="860" y="60" font-size="12" font-weight="bold" text-anchor="middle" fill="#b91c1c">Database</text>
          <text x="860" y="80" font-size="10" text-anchor="middle" fill="#666">Persistence</text>
          
          <!-- Request flow (top) -->
          <g stroke="#0f766e" stroke-width="2" fill="none" marker-end="url(#arrowGreen)">
            <line x1="170" y1="60" x2="220" y2="60"/>
            <line x1="360" y1="60" x2="410" y2="60"/>
            <line x1="550" y1="60" x2="600" y2="60"/>
            <line x1="740" y1="60" x2="790" y2="60"/>
          </g>
          
          <!-- Request labels -->
          <text x="195" y="50" font-size="9" fill="#0f766e">1. Request</text>
          <text x="380" y="50" font-size="9" fill="#0f766e">2. Validate</text>
          <text x="570" y="50" font-size="9" fill="#0f766e">3. HTTP Call</text>
          <text x="760" y="50" font-size="9" fill="#0f766e">4. Query</text>
          
          <!-- Response flow (bottom) -->
          <g stroke="#b91c1c" stroke-width="2" fill="none" marker-end="url(#arrowRed)">
            <line x1="790" y1="110" x2="740" y2="110"/>
            <line x1="600" y1="110" x2="550" y2="110"/>
            <line x1="410" y1="110" x2="360" y2="110"/>
            <line x1="220" y1="110" x2="170" y2="110"/>
          </g>
          
          <!-- Response labels -->
          <text x="760" y="130" font-size="9" fill="#b91c1c">5. Response</text>
          <text x="570" y="130" font-size="9" fill="#b91c1c">6. Parse Data</text>
          <text x="380" y="130" font-size="9" fill="#b91c1c">7. Map DTO</text>
          <text x="195" y="130" font-size="9" fill="#b91c1c">8. Update UI</text>
          
          <!-- Processing layers detail -->
          <g>
            <!-- MFE Processing -->
            <rect x="30" y="180" width="140" height="270" fill="#fcfcfd" stroke="#999" stroke-width="1" stroke-dasharray="3,3" rx="4"/>
            <text x="100" y="205" font-size="11" font-weight="bold" text-anchor="middle" fill="#111">MFE Logic</text>
            
            <rect x="45" y="220" width="110" height="50" fill="#fee2e2" stroke="#b91c1c" stroke-width="1" rx="3"/>
            <text x="100" y="240" font-size="9" font-weight="bold" text-anchor="middle">Presentation</text>
            <text x="100" y="255" font-size="8" text-anchor="middle" fill="#666">Page Component</text>
            
            <rect x="45" y="280" width="110" height="50" fill="#fef2f2" stroke="#b91c1c" stroke-width="1" rx="3"/>
            <text x="100" y="300" font-size="9" font-weight="bold" text-anchor="middle">Application</text>
            <text x="100" y="315" font-size="8" text-anchor="middle" fill="#666">Use Case</text>
            
            <rect x="45" y="340" width="110" height="50" fill="#f9f5ff" stroke="#7c3aed" stroke-width="1" rx="3"/>
            <text x="100" y="360" font-size="9" font-weight="bold" text-anchor="middle">Infrastructure</text>
            <text x="100" y="375" font-size="8" text-anchor="middle" fill="#666">Repository</text>
            
            <rect x="45" y="400" width="110" height="50" fill="#ecfdf5" stroke="#0f766e" stroke-width="1" rx="3"/>
            <text x="100" y="420" font-size="9" font-weight="bold" text-anchor="middle">Domain</text>
            <text x="100" y="435" font-size="8" text-anchor="middle" fill="#666">Business Rules</text>
          </g>
          
          <!-- Backend Processing -->
          <g>
            <rect x="600" y="180" width="140" height="270" fill="#fcfcfd" stroke="#999" stroke-width="1" stroke-dasharray="3,3" rx="4"/>
            <text x="670" y="205" font-size="11" font-weight="bold" text-anchor="middle" fill="#111">Backend API</text>
            
            <rect x="615" y="220" width="110" height="50" fill="#eff6ff" stroke="#1d4ed8" stroke-width="1" rx="3"/>
            <text x="670" y="240" font-size="9" font-weight="bold" text-anchor="middle">Controller</text>
            <text x="670" y="255" font-size="8" text-anchor="middle" fill="#666">Route Handler</text>
            
            <rect x="615" y="280" width="110" height="50" fill="#eff6ff" stroke="#1d4ed8" stroke-width="1" rx="3"/>
            <text x="670" y="300" font-size="9" font-weight="bold" text-anchor="middle">Service</text>
            <text x="670" y="315" font-size="8" text-anchor="middle" fill="#666">Business Logic</text>
            
            <rect x="615" y="340" width="110" height="50" fill="#eff6ff" stroke="#1d4ed8" stroke-width="1" rx="3"/>
            <text x="670" y="360" font-size="9" font-weight="bold" text-anchor="middle">Repository</text>
            <text x="670" y="375" font-size="8" text-anchor="middle" fill="#666">Data Access</text>
            
            <rect x="615" y="400" width="110" height="50" fill="#fef2f2" stroke="#b91c1c" stroke-width="1" rx="3"/>
            <text x="670" y="420" font-size="9" font-weight="bold" text-anchor="middle">Database</text>
            <text x="670" y="435" font-size="8" text-anchor="middle" fill="#666">Persistence</text>
          </g>
          
          <defs>
            <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#0f766e"/>
            </marker>
            <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#b91c1c"/>
            </marker>
          </defs>
        </svg>

        <h3>Scenario: User Logs In and Opens Inventory Module</h3>
        <ol>
          <li>يفتح المستخدم منصة ERP</li>
          <li>يبدأ Shell ويهيئ مزودي الخدمات الأساسيين</li>
          <li>
            <strong>Authentication bootstrap يبدأ:</strong>
            <ul>
              <li>يتحقق Shell من الجلسة أو يعيد التوجيه إلى تسجيل الدخول</li>
              <li>يقوم المستخدم بالمصادقة بنجاح</li>
            </ul>
          </li>
          <li>
            <strong>Session Context تم تهيئتها:</strong>
            <ul>
              <li>تم تحميل ملف التعريف والمستأجر / الشركة والمطالبات / الأذونات واللغة</li>
            </ul>
          </li>
          <li>
            <strong>MFE Manifests تم تحميلها:</strong>
            <ul>
              <li>يقرأ Shell الوحدات المسجلة (HR, Inventory, Sales, Finance, إلخ)</li>
            </ul>
          </li>
          <li>
            <strong>Menu تم بناؤها:</strong>
            <ul>
              <li>يقوم Shell بتصفية الوحدات بناءً على الأذونات</li>
              <li>مثال: يمكن للمستخدمين رؤية Inventory و Sales لكن ليس Finance</li>
            </ul>
          </li>
          <li>
            <strong>المستخدم ينقر على "Inventory":</strong>
            <ul>
              <li>Shell Routes إلى <code>/inventory/*</code></li>
            </ul>
          </li>
          <li>
            <strong>MFE-Inventory تم تحميلها:</strong>
            <ul>
              <li>يحمل Shell MFE-Inventory Bundle</li>
              <li>يمرر Shell Host Context (Auth/Session, Tenant, Theme, i18n, Telemetry)</li>
              <li>MFE Mount في Workspace</li>
            </ul>
          </li>
          <li>
            <strong>Inventory MFE تتعامل مع الصفحات الداخلية:</strong>
            <ul>
              <li>Internal Routes: <code>/inventory/items</code>, <code>/inventory/warehouses</code>, إلخ</li>
            </ul>
          </li>
          <li>
            <strong>إذا فشل تحميل الوحدة:</strong>
            <ul>
              <li>يعرض Shell Fallback Panel بدون كسر إطار ERP</li>
            </ul>
          </li>
        </ol>

        <div class="highlight">
          يضمن هذا التدفق تجربة منصة متسقة مع الحفاظ على Modular Ownership.
        </div>
      </section>

      <!-- 4. Domain Micro-Frontends -->
      <section class="card" id="mfes">
        <h2>4) Domain Micro-Frontends</h2>

        <h3>ERP Domain Modules Distribution</h3>
        <svg viewBox="0 0 1000 500" style="width: 100%; max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;">
          <!-- Central Shell -->
          <circle cx="500" cy="250" r="80" fill="#ecfdf5" stroke="#0f766e" stroke-width="3"/>
          <text x="500" y="240" font-size="14" font-weight="bold" text-anchor="middle" fill="#0f766e">Shell</text>
          <text x="500" y="260" font-size="11" text-anchor="middle" fill="#0f766e">Platform</text>
          <text x="500" y="280" font-size="11" text-anchor="middle" fill="#0f766e">Orchestrator</text>
          
          <!-- Domain MFEs arranged in circle -->
          <!-- HR Module -->
          <circle cx="150" cy="100" r="50" fill="#eff6ff" stroke="#1d4ed8" stroke-width="2"/>
          <text x="150" y="95" font-size="12" font-weight="bold" text-anchor="middle" fill="#1d4ed8">MFE</text>
          <text x="150" y="115" font-size="11" font-weight="bold" text-anchor="middle" fill="#1d4ed8">HR</text>
          <text x="150" y="135" font-size="9" text-anchor="middle" fill="#666">/hr/*</text>
          <line x1="195" y1="120" x2="450" y2="220" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
          
          <!-- Inventory Module -->
          <circle cx="100" cy="280" r="50" fill="#fef2f2" stroke="#b91c1c" stroke-width="2"/>
          <text x="100" y="275" font-size="12" font-weight="bold" text-anchor="middle" fill="#b91c1c">MFE</text>
          <text x="100" y="295" font-size="11" font-weight="bold" text-anchor="middle" fill="#b91c1c">Inventory</text>
          <text x="100" y="315" font-size="9" text-anchor="middle" fill="#666">/inventory/*</text>
          <line x1="145" y1="300" x2="445" y2="280" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
          
          <!-- Sales Module -->
          <circle cx="200" cy="420" r="50" fill="#fffbeb" stroke="#b45309" stroke-width="2"/>
          <text x="200" y="415" font-size="12" font-weight="bold" text-anchor="middle" fill="#b45309">MFE</text>
          <text x="200" y="435" font-size="11" font-weight="bold" text-anchor="middle" fill="#b45309">Sales</text>
          <text x="200" y="455" font-size="9" text-anchor="middle" fill="#666">/sales/*</text>
          <line x1="245" y1="405" x2="450" y2="310" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
          
          <!-- Finance Module -->
          <circle cx="400" cy="480" r="50" fill="#f3e8ff" stroke="#a855f7" stroke-width="2"/>
          <text x="400" y="475" font-size="12" font-weight="bold" text-anchor="middle" fill="#a855f7">MFE</text>
          <text x="400" y="495" font-size="11" font-weight="bold" text-anchor="middle" fill="#a855f7">Finance</text>
          <text x="400" y="515" font-size="9" text-anchor="middle" fill="#666">/finance/*</text>
          <line x1="420" y1="445" x2="480" y2="310" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
          
          <!-- Procurement Module -->
          <circle cx="600" cy="480" r="50" fill="#e0e7ff" stroke="#6366f1" stroke-width="2"/>
          <text x="600" y="475" font-size="12" font-weight="bold" text-anchor="middle" fill="#6366f1">MFE</text>
          <text x="600" y="495" font-size="11" font-weight="bold" text-anchor="middle" fill="#6366f1">Procurement</text>
          <text x="600" y="515" font-size="9" text-anchor="middle" fill="#666">/purchase/*</text>
          <line x1="580" y1="445" x2="520" y2="310" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
          
          <!-- CRM Module -->
          <circle cx="800" cy="420" r="50" fill="#fce7f3" stroke="#ec4899" stroke-width="2"/>
          <text x="800" y="415" font-size="12" font-weight="bold" text-anchor="middle" fill="#ec4899">MFE</text>
          <text x="800" y="435" font-size="11" font-weight="bold" text-anchor="middle" fill="#ec4899">CRM</text>
          <text x="800" y="455" font-size="9" text-anchor="middle" fill="#666">/crm/*</text>
          <line x1="755" y1="405" x2="550" y2="310" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
          
          <!-- Reporting Module -->
          <circle cx="900" cy="280" r="50" fill="#f0fdfa" stroke="#14b8a6" stroke-width="2"/>
          <text x="900" y="275" font-size="12" font-weight="bold" text-anchor="middle" fill="#14b8a6">MFE</text>
          <text x="900" y="295" font-size="11" font-weight="bold" text-anchor="middle" fill="#14b8a6">Reporting</text>
          <text x="900" y="315" font-size="9" text-anchor="middle" fill="#666">/reports/*</text>
          <line x1="855" y1="300" x2="555" y2="280" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
          
          <!-- Shared Data Module -->
          <circle cx="850" cy="100" r="50" fill="#f5f3ff" stroke="#8b5cf6" stroke-width="2"/>
          <text x="850" y="95" font-size="12" font-weight="bold" text-anchor="middle" fill="#8b5cf6">Shared</text>
          <text x="850" y="115" font-size="11" font-weight="bold" text-anchor="middle" fill="#8b5cf6">Libraries</text>
          <text x="850" y="135" font-size="9" text-anchor="middle" fill="#666">UI, Utils</text>
          <line x1="805" y1="120" x2="555" y2="220" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/>
        </svg>

        <h3>4.1) Definition of a Micro-Frontend</h3>
        <p>
          في هذه المعمارية، Micro-Frontend (MFE) هي وحدة Frontend مبنية على أساس المجال والمدمجة في المنصة
          من خلال Host Application (Shell).
        </p>
        <p>
          تُعامل كل MFE كـ mini-application مع:
        </p>
        <ul>
          <li>Clear domain ownership</li>
          <li>Internal routing تحت dedicated base route</li>
          <li>Domain UI و workflows</li>
          <li>Controlled integration مع Shell من خلال عقود محددة</li>
        </ul>

        <h3>4.2) MFE Boundaries & Responsibilities</h3>
        <p>تملك كل MFE نطاق Frontend الخاص بالمجال:</p>
        <ul>
          <li>Domain-specific pages و workflows</li>
          <li>Internal routing تحت base route its MFE</li>
          <li>Domain UI components و screen composition</li>
          <li>Local state و interaction orchestration</li>
          <li>Domain API integration adapters</li>
          <li>Module-level validations و UI behavior</li>
          <li>Module-level telemetry events (aligned مع platform standards)</li>
        </ul>

        <h3>4.3) Base Route Ownership</h3>
        <p>يجب أن يحتوي كل MFE على unique base route معين من قبل المنصة:</p>
        <ul>
          <li>MFE-HR → <code>/hr/*</code></li>
          <li>MFE-Inventory → <code>/inventory/*</code></li>
          <li>MFE-Sales → <code>/sales/*</code></li>
          <li>MFE-Finance → <code>/finance/*</code></li>
        </ul>
        <p>
          Sub-routes الداخلية مملوكة بالكامل للـ MFE. مثال (Inventory):
          <code>/inventory/items</code>, <code>/inventory/warehouses</code>, <code>/inventory/stock-transfer</code>
        </p>

        <div class="highlight">
          <strong>Rule:</strong> Base Routes معينة من Platform وفريدة؛ sub-routes الداخلية مملوكة للـ MFE.
        </div>

        <h3>4.4) Independent Development & Deployment</h3>
        <p>
          يجب أن تدعم كل MFE التطوير المستقل وحيث ينطبق ذلك النشر المستقل.
        </p>
        <p>الفريق المالك يمكنه:</p>
        <ul>
          <li>تطوير واختبار الوحدة بشكل مستقل</li>
          <li>تطوير Domain Workflows بدون تغيير MFEs غير ذات الصلة</li>
          <li>إصدار التغييرات مع الحفاظ على التوافق مع عقود Platform</li>
        </ul>

        <div class="highlight">
          <strong>Principle:</strong> Independent Delivery مع Platform Consistency.
        </div>

        <h3>4.5) MFE Boundary Best Practices</h3>

        <h4 style="color: #059669;">✅ Do's</h4>
        <ul>
          <li>Design MFEs حول Business Domains (HR, Inventory, Finance)</li>
          <li>أبق Domain UI و workflows داخل MFE المالك</li>
          <li>امتلك وأدر Sub-routes تحت assigned base path</li>
          <li>Use Shared Platform Components/Utilities للـ generic reusable needs</li>
          <li>Follow Shell Integration Contract (Manifest, Mount, Host Context)</li>
          <li>Emit Telemetry باستخدام Platform Standards</li>
          <li>عزل Module Failures والتعامل مع Local Errors بأناقة</li>
          <li>أبق Domain Validation و Business Logic محليين في MFE</li>
        </ul>

        <h4 style="color: #b91c1c;">❌ Don'ts</h4>
        <ul>
          <li>Import Internals من MFE آخر</li>
          <li>ضع Domain Business Logic في Shared Components/Utilities</li>
          <li>أعد تطبيق Shell Responsibilities (Global Menu, Auth Bootstrap, Layout)</li>
          <li>امتلك Routes خارج Assigned Base Route Namespace</li>
          <li>تجاوز Platform Contracts للوصول إلى Shell Internals</li>
          <li>أنشئ Hidden Runtime Coupling بين MFEs</li>
          <li>استخدم Shared Layer كـ Dumping Ground للكود</li>
          <li>افترض أن Frontend Permission Checks تحل محل Backend Authorization</li>
        </ul>
      </section>

      <!-- 5. Clean Architecture -->
      <section class="card" id="clean-arch">
        <h2>5) Clean Architecture (Inside MFE)</h2>
        <p>
          تطبق كل Micro-Frontend مبادئ Clean Architecture للحفاظ على فصل واضح للمخاوف
          وتمكين التطور المستقل.
        </p>

        <h3>5.1) Typical MFE Directory Structure</h3>
        
        <svg viewBox="0 0 900 600" style="width: 100%; max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;">
          <defs>
            <marker id="cleanArrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#374151"/>
            </marker>
          </defs>

          <rect x="20" y="20" width="860" height="560" fill="#fcfcfd" stroke="#d1d5db" stroke-width="1.5" rx="10"/>
          <text x="450" y="48" font-size="16" font-weight="bold" text-anchor="middle" fill="#111827">Clean Architecture (Inside One MFE)</text>

          <rect x="70" y="90" width="500" height="450" fill="#f9fafb" stroke="#9ca3af" stroke-width="1" rx="8"/>

          <rect x="95" y="110" width="450" height="90" fill="#fee2e2" stroke="#b91c1c" stroke-width="1.5" rx="6"/>
          <text x="320" y="137" font-size="12" font-weight="bold" text-anchor="middle" fill="#b91c1c">Presentation Layer</text>
          <text x="320" y="157" font-size="10" text-anchor="middle" fill="#4b5563">Pages, Components, Forms, View Models</text>
          <text x="320" y="175" font-size="10" text-anchor="middle" fill="#4b5563">Consumes application state and actions</text>

          <rect x="110" y="220" width="420" height="90" fill="#dbeafe" stroke="#1d4ed8" stroke-width="1.5" rx="6"/>
          <text x="320" y="247" font-size="12" font-weight="bold" text-anchor="middle" fill="#1d4ed8">Application Layer</text>
          <text x="320" y="267" font-size="10" text-anchor="middle" fill="#4b5563">Use Cases, Commands, Queries, State Orchestration</text>
          <text x="320" y="285" font-size="10" text-anchor="middle" fill="#4b5563">Coordinates domain operations</text>

          <rect x="125" y="330" width="390" height="90" fill="#ede9fe" stroke="#7c3aed" stroke-width="1.5" rx="6"/>
          <text x="320" y="357" font-size="12" font-weight="bold" text-anchor="middle" fill="#7c3aed">Infrastructure Layer</text>
          <text x="320" y="377" font-size="10" text-anchor="middle" fill="#4b5563">API Clients, Repository Implementations, Telemetry</text>
          <text x="320" y="395" font-size="10" text-anchor="middle" fill="#4b5563">Implements outbound technical details</text>

          <rect x="140" y="440" width="360" height="80" fill="#dcfce7" stroke="#0f766e" stroke-width="2" rx="6"/>
          <text x="320" y="467" font-size="12" font-weight="bold" text-anchor="middle" fill="#0f766e">Domain Layer (Core)</text>
          <text x="320" y="487" font-size="10" text-anchor="middle" fill="#4b5563">Entities, Value Objects, Business Rules, Contracts</text>

          <line x1="320" y1="200" x2="320" y2="220" stroke="#374151" stroke-width="2" marker-end="url(#cleanArrow)"/>
          <line x1="320" y1="310" x2="320" y2="330" stroke="#374151" stroke-width="2" marker-end="url(#cleanArrow)"/>
          <line x1="320" y1="420" x2="320" y2="440" stroke="#374151" stroke-width="2" marker-end="url(#cleanArrow)"/>

          <text x="340" y="214" font-size="9" fill="#374151">depends on</text>
          <text x="340" y="324" font-size="9" fill="#374151">depends on</text>
          <text x="340" y="434" font-size="9" fill="#374151">implements contracts</text>

          <rect x="595" y="90" width="260" height="450" fill="#ffffff" stroke="#d1d5db" stroke-width="1" rx="8"/>
          <text x="725" y="118" font-size="13" font-weight="bold" text-anchor="middle" fill="#111827">Dependency Rules</text>

          <rect x="615" y="140" width="220" height="95" fill="#f0fdf4" stroke="#059669" stroke-width="1" rx="6"/>
          <text x="725" y="164" font-size="11" font-weight="bold" text-anchor="middle" fill="#047857">Allowed</text>
          <text x="900" y="185" font-size="10" fill="#4b5563">Presentation → Application • Application → Domain • Infrastructure → Domain contracts</text>
          <text x="750" y="203" font-size="10" fill="#4b5563"> Application → Domain •</text>
          <text x="800" y="221" font-size="10" fill="#4b5563"> Infrastructure → Domain contracts •</text>

          <rect x="615" y="250" width="220" height="95" fill="#fef2f2" stroke="#b91c1c" stroke-width="1" rx="6"/>
          <text x="725" y="274" font-size="11" font-weight="bold" text-anchor="middle" fill="#b91c1c">Not Allowed</text>
          <text x="625" y="295" font-size="10" fill="#4b5563">• Domain → UI / HTTP / Framework</text>
          <text x="625" y="313" font-size="10" fill="#4b5563">• Application → Presentation</text>
          <text x="625" y="331" font-size="10" fill="#4b5563">• Cross-layer shortcuts</text>

          <rect x="615" y="360" width="220" height="140" fill="#fffbeb" stroke="#b45309" stroke-width="1" rx="6"/>
          <text x="725" y="384" font-size="11" font-weight="bold" text-anchor="middle" fill="#b45309">Core Principle</text>
          <text x="625" y="406" font-size="10" fill="#4b5563">Outer layers depend inward.</text>
          <text x="625" y="424" font-size="10" fill="#4b5563">Domain stays framework-agnostic.</text>
          <text x="625" y="442" font-size="10" fill="#4b5563">Contracts protect architecture boundaries.</text>
          <text x="625" y="460" font-size="10" fill="#4b5563">Adapters isolate technical changes.</text>
        </svg>

        <h3>5.1) Typical MFE Directory Structure</h3>
        <pre>
project-root/
├── src/
│   ├── domain/                    # Business Logic
│   │   ├── entities/
│   │   ├── valueObjects/
│   │   ├── useCases/
│   │   ├── interfaces/
│   │   └── services/
│   │
│   ├── application/               # State & Application Services
│   │   ├── services/
│   │   ├── state/                 # Redux / Zustand / Context
│   │   ├── hooks/
│   │   ├── commands/
│   │   ├── queries/
│   │   ├── dto/
│   │   └── mappers/
│   │
│   ├── infrastructure/            # External Integrations
│   │   ├── api/
│   │   ├── repositories/
│   │   ├── authentication/
│   │   ├── storage/
│   │   ├── telemetry/
│   │   ├── cache/
│   │   ├── mappers/
│   │   └── utils/
│   │
│   ├── presentation/              # UI Layer (Atomic Design)
│   │   ├── atoms/
│   │   ├── molecules/
│   │   ├── organisms/
│   │   ├── templates/
│   │   ├── pages/
│   │   ├── routes/
│   │   ├── forms/
│   │   └── viewModels/
│   │
│   ├── integration/               # Shell/MFE Integration
│   │   ├── manifest/
│   │   ├── hostContracts/
│   │   └── events/
│   │
│   ├── bootstrap/                 # MFE mount/unmount
│   │   ├── mount.tsx
│   │   └── unmount.ts
│   │
│   ├── assets/
│   ├── tests/
│   ├── index.ts
│   └── main.tsx
        </pre>

        <h3>5.2) Layer Responsibilities</h3>

        <h4>Domain Layer</h4>
        <p>
          يحتوي على Business Concepts الأساسية والقواعس. يجب أن تكون مستقلة عن UI Frameworks و HTTP Libraries و Browser APIs.
        </p>
        <ul>
          <li><strong>No React/UI Code</strong></li>
          <li><strong>No API Calls</strong></li>
          <li><strong>No Storage/Browser Dependencies</strong></li>
          <li><strong>No Framework-Specific Imports</strong></li>
        </ul>

        <h4>Application Layer</h4>
        <p>
          ينسق Use Cases وتطبيق التدفق. يعمل كـ Bridge بين Presentation و Domain.
        </p>
        <ul>
          <li>Use Case Implementations / Orchestration Services</li>
          <li>Application Services و Commands/Queries</li>
          <li>State Orchestration Logic</li>
          <li>DTO-to-Domain / Domain-to-ViewModel Coordination</li>
        </ul>

        <h4>Infrastructure Layer</h4>
        <p>
          Technical Implementations للتفاعل مع External Systems و Platform Services.
        </p>
        <ul>
          <li>HTTP/API Clients (domain-specific adapters)</li>
          <li>Repository Implementations</li>
          <li>Storage و Data Source Adapters</li>
          <li>Telemetry/Logging Adapters</li>
          <li>Error Translation Adapters</li>
        </ul>

        <h4>Presentation Layer</h4>
        <p>UI و Interaction Logic.</p>
        <ul>
          <li>Pages / Screens</li>
          <li>UI Components (Atomic Design Structure)</li>
          <li>Local Routes (تحت MFE Base Route)</li>
          <li>Forms و UI-Level Validations</li>
          <li>View Models / Presentation Mappers</li>
          <li>Loading/Error/Empty States</li>
        </ul>

        <h3>5.3) Dependency Direction Rules</h3>
        
        <h3>Visual Dependency Architecture</h3>
        <svg viewBox="0 0 1000 450" style="width: 100%; max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;">
          <!-- Left side: Allowed dependencies -->
          <g>
            <rect x="30" y="30" width="420" height="380" fill="#f0fdf4" stroke="#059669" stroke-width="2" rx="8"/>
            <text x="240" y="60" font-size="13" font-weight="bold" fill="#059669">✓ Allowed Dependencies</text>
            
            <!-- Presentation -->
            <rect x="50" y="80" width="380" height="60" fill="#dcfce7" stroke="#059669" stroke-width="1" rx="4"/>
            <text x="240" y="100" font-size="12" font-weight="bold" text-anchor="middle" fill="#059669">Presentation Layer</text>
            <text x="240" y="125" font-size="10" text-anchor="middle" fill="#666">Pages, UI Components, Forms</text>
            
            <!-- Arrow down -->
            <line x1="240" y1="140" x2="240" y2="160" stroke="#059669" stroke-width="2" marker-end="url(#arrowGreen)"/>
            <text x="245" y="155" font-size="9" fill="#059669">depends</text>
            
            <!-- Application -->
            <rect x="50" y="160" width="380" height="60" fill="#dcfce7" stroke="#059669" stroke-width="1" rx="4"/>
            <text x="240" y="180" font-size="12" font-weight="bold" text-anchor="middle" fill="#059669">Application Layer</text>
            <text x="240" y="205" font-size="10" text-anchor="middle" fill="#666">Use Cases, Commands, State</text>
            
            <!-- Arrow down -->
            <line x1="240" y1="220" x2="240" y2="240" stroke="#059669" stroke-width="2" marker-end="url(#arrowGreen)"/>
            <text x="245" y="235" font-size="9" fill="#059669">depends</text>
            
            <!-- Infrastructure -->
            <rect x="50" y="240" width="380" height="60" fill="#dcfce7" stroke="#059669" stroke-width="1" rx="4"/>
            <text x="240" y="260" font-size="12" font-weight="bold" text-anchor="middle" fill="#059669">Infrastructure Layer</text>
            <text x="240" y="285" font-size="10" text-anchor="middle" fill="#666">API Clients, Repositories, Storage</text>
            
            <!-- Arrow down -->
            <line x1="240" y1="300" x2="240" y2="320" stroke="#059669" stroke-width="2" marker-end="url(#arrowGreen)"/>
            <text x="245" y="315" font-size="9" fill="#059669">implements</text>
            
            <!-- Domain -->
            <rect x="50" y="320" width="380" height="60" fill="#dcfce7" stroke="#059669" stroke-width="1" rx="4"/>
            <text x="240" y="340" font-size="12" font-weight="bold" text-anchor="middle" fill="#059669">Domain Layer</text>
            <text x="240" y="365" font-size="10" text-anchor="middle" fill="#666">Entities, Value Objects, Interfaces</text>
          </g>
          
          <!-- Right side: Not allowed dependencies -->
          <g>
            <rect x="520" y="30" width="420" height="380" fill="#fef2f2" stroke="#b91c1c" stroke-width="2" rx="8"/>
            <text x="730" y="60" font-size="13" font-weight="bold" fill="#b91c1c">✗ Not Allowed</text>
            
            <!-- Domain (at top, trying to go up) -->
            <rect x="540" y="80" width="380" height="60" fill="#fee2e2" stroke="#b91c1c" stroke-width="1" rx="4"/>
            <text x="730" y="100" font-size="12" font-weight="bold" text-anchor="middle" fill="#b91c1c">Domain Layer</text>
            <text x="730" y="125" font-size="10" text-anchor="middle" fill="#666">Cannot import UI/HTTP/Framework code</text>
            
            <!-- Blocked arrows -->
            <line x1="730" y1="140" x2="730" y2="160" stroke="#b91c1c" stroke-width="2" stroke-dasharray="5,5"/>
            <text x="645" y="155" font-size="9" fill="#b91c1c">✗ NOT allowed</text>
            
            <!-- Application -->
            <rect x="540" y="160" width="380" height="60" fill="#fee2e2" stroke="#b91c1c" stroke-width="1" rx="4"/>
            <text x="730" y="180" font-size="12" font-weight="bold" text-anchor="middle" fill="#b91c1c">Application Layer</text>
            <text x="730" y="205" font-size="10" text-anchor="middle" fill="#666">Cannot import Presentation code</text>
            
            <!-- Blocked arrow -->
            <line x1="730" y1="220" x2="730" y2="240" stroke="#b91c1c" stroke-width="2" stroke-dasharray="5,5"/>
            <text x="645" y="235" font-size="9" fill="#b91c1c">✗ NOT allowed</text>
            
            <!-- Infrastructure -->
            <rect x="540" y="240" width="380" height="60" fill="#fee2e2" stroke="#b91c1c" stroke-width="1" rx="4"/>
            <text x="730" y="260" font-size="12" font-weight="bold" text-anchor="middle" fill="#b91c1c">Infrastructure Layer</text>
            <text x="730" y="285" font-size="10" text-anchor="middle" fill="#666">Can only depend on Domain contracts</text>
            
            <!-- Blocked arrow -->
            <line x1="730" y1="300" x2="730" y2="320" stroke="#b91c1c" stroke-width="2" stroke-dasharray="5,5"/>
            <text x="645" y="315" font-size="9" fill="#b91c1c">✗ Can't bypass</text>
            
            <!-- Presentation -->
            <rect x="540" y="320" width="380" height="60" fill="#fee2e2" stroke="#b91c1c" stroke-width="1" rx="4"/>
            <text x="730" y="340" font-size="12" font-weight="bold" text-anchor="middle" fill="#b91c1c">Presentation Layer</text>
            <text x="730" y="365" font-size="10" text-anchor="middle" fill="#666">Cannot skip Application layer</text>
          </g>
          
          <defs>
            <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#059669"/>
            </marker>
          </defs>
        </svg>

        <h3>5.3) Dependency Direction Rules</h3>
        <p><strong>جهات Allowed:</strong></p>
        <ul>
          <li>Presentation → Application</li>
          <li>Application → Domain</li>
          <li>Infrastructure → Domain / Application Contracts</li>
        </ul>

        <p><strong>Not Allowed:</strong></p>
        <ul>
          <li>Domain → Application / Infrastructure / Presentation</li>
          <li>Application → Presentation</li>
          <li>Domain → UI Framework / HTTP Libraries</li>
        </ul>

        <div class="highlight">
          <strong>Core Principle:</strong> Outer Layers تعتمد على Inner Layers؛ Inner Layers تحدد القواعد.
          يجب ألا تعرف Inner Layers تفاصيل تطبيق Outer Layers.
        </div>

        <h3>5.4) DTO & Mapper Guidelines</h3>
        <p>
          لتجنب الاقتران بين Layers و External APIs استخدم DTOs والمحولات بوضوح:
        </p>
        <ul>
          <li><strong>Request/Response DTOs:</strong> Infrastructure/API-Facing</li>
          <li><strong>Application DTOs:</strong> Use Case Inputs/Outputs</li>
          <li><strong>View Models / Presentation Models:</strong> UI-Facing</li>
        </ul>

        <p>
          أبق Mapping Logic مركزياً (Mappers/Adapters)، لا متناثرة عبر Pages/Components.
          لا تعرض Raw API Response Objects مباشرة للـ Presentation.
        </p>
      </section>

      <!-- 6. State Management & Data Flow -->
      <section class="card" id="state-mgmt">
        <h2>6) State Management Pattern inside MFE</h2>
        
        <h3>Recommended State Management Flow</h3>
        <svg viewBox="0 0 1000 500" style="width: 100%; max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;">
          <!-- User Interaction -->
          <rect x="30" y="30" width="150" height="70" fill="#fef2f2" stroke="#b91c1c" stroke-width="2" rx="6"/>
          <text x="105" y="55" font-size="12" font-weight="bold" text-anchor="middle" fill="#b91c1c">User</text>
          <text x="105" y="75" font-size="10" text-anchor="middle" fill="#666">Interaction</text>
          
          <!-- Arrow -->
          <line x1="180" y1="65" x2="220" y2="65" stroke="#666" stroke-width="2" marker-end="url(#arrow1)"/>
          <text x="200" y="55" font-size="9" fill="#666">Event</text>
          
          <!-- Presentation Component -->
          <rect x="220" y="30" width="150" height="70" fill="#fee2e2" stroke="#b91c1c" stroke-width="2" rx="6"/>
          <text x="295" y="55" font-size="12" font-weight="bold" text-anchor="middle" fill="#b91c1c">Presentation</text>
          <text x="295" y="75" font-size="10" text-anchor="middle" fill="#666">Component</text>
          
          <!-- Arrow to Dispatch -->
          <line x1="370" y1="65" x2="410" y2="65" stroke="#666" stroke-width="2" marker-end="url(#arrow1)"/>
          <text x="390" y="55" font-size="9" fill="#666">Dispatch</text>
          
          <!-- Application Service / Action -->
          <rect x="410" y="30" width="150" height="70" fill="#eff6ff" stroke="#1d4ed8" stroke-width="2" rx="6"/>
          <text x="485" y="55" font-size="12" font-weight="bold" text-anchor="middle" fill="#1d4ed8">Application</text>
          <text x="485" y="75" font-size="10" text-anchor="middle" fill="#666">Action/Command</text>
          
          <!-- Arrow to Domain -->
          <line x1="560" y1="65" x2="600" y2="65" stroke="#666" stroke-width="2" marker-end="url(#arrow1)"/>
          <text x="580" y="55" font-size="9" fill="#666">Execute</text>
          
          <!-- Domain Logic -->
          <rect x="600" y="30" width="150" height="70" fill="#ecfdf5" stroke="#0f766e" stroke-width="2" rx="6"/>
          <text x="675" y="55" font-size="12" font-weight="bold" text-anchor="middle" fill="#0f766e">Domain</text>
          <text x="675" y="75" font-size="10" text-anchor="middle" fill="#666">Business Logic</text>
          
          <!-- Arrow to Infrastructure -->
          <line x1="750" y1="65" x2="790" y2="65" stroke="#666" stroke-width="2" marker-end="url(#arrow1)"/>
          <text x="770" y="55" font-size="9" fill="#666">Fetch Data</text>
          
          <!-- Infrastructure / API -->
          <rect x="790" y="30" width="150" height="70" fill="#f9f5ff" stroke="#7c3aed" stroke-width="2" rx="6"/>
          <text x="865" y="55" font-size="12" font-weight="bold" text-anchor="middle" fill="#7c3aed">Infrastructure</text>
          <text x="865" y="75" font-size="10" text-anchor="middle" fill="#666">API Call</text>
          
          <!-- Reverse flow (Response) -->
          <!-- Bottom part - return data -->
          <g>
            <!-- API Response -->
            <line x1="865" y1="100" x2="865" y2="130" stroke="#b91c1c" stroke-width="2" marker-end="url(#arrow2)"/>
            <text x="900" y="120" font-size="9" fill="#b91c1c">Response</text>
            
            <!-- Infrastructure processes -->
            <rect x="790" y="130" width="150" height="70" fill="#fef9f8" stroke="#7c3aed" stroke-width="1" rx="6"/>
            <text x="865" y="150" font-size="10" text-anchor="middle" fill="#666">Parse & Map</text>
            <text x="865" y="170" font-size="10" text-anchor="middle" fill="#666">to Domain</text>
            
            <!-- Back to Domain -->
            <line x1="790" y1="165" x2="750" y2="165" stroke="#b91c1c" stroke-width="2" marker-end="url(#arrow2)"/>
            <text x="770" y="155" font-size="9" fill="#b91c1c">Result</text>
            
            <!-- Domain to Application -->
            <rect x="600" y="130" width="150" height="70" fill="#fef9f8" stroke="#0f766e" stroke-width="1" rx="6"/>
            <text x="675" y="150" font-size="10" text-anchor="middle" fill="#666">Validate & Map</text>
            <text x="675" y="170" font-size="10" text-anchor="middle" fill="#666">to Use Case</text>
            
            <!-- Application to State -->
            <line x1="600" y1="165" x2="560" y2="165" stroke="#b91c1c" stroke-width="2" marker-end="url(#arrow2)"/>
            <text x="580" y="155" font-size="9" fill="#b91c1c">Update</text>
            
            <!-- Application State -->
            <rect x="410" y="130" width="150" height="70" fill="#fef2f2" stroke="#1d4ed8" stroke-width="1" rx="6"/>
            <text x="485" y="155" font-size="10" text-anchor="middle" fill="#666">Update State</text>
            <text x="485" y="170" font-size="10" text-anchor="middle" fill="#666">(Redux/Zustand)</text>
            
            <!-- State to Presentation -->
            <line x1="410" y1="165" x2="370" y2="165" stroke="#b91c1c" stroke-width="2" marker-end="url(#arrow2)"/>
            <text x="390" y="155" font-size="9" fill="#b91c1c">Notify</text>
            
            <!-- Presentation Re-renders -->
            <rect x="220" y="130" width="150" height="70" fill="#fef2f2" stroke="#b91c1c" stroke-width="1" rx="6"/>
            <text x="295" y="155" font-size="10" text-anchor="middle" fill="#666">Re-render UI</text>
            <text x="295" y="170" font-size="10" text-anchor="middle" fill="#666">with New Data</text>
            
            <!-- Back to User -->
            <line x1="220" y1="165" x2="180" y2="165" stroke="#b91c1c" stroke-width="2" marker-end="url(#arrow2)"/>
            <text x="200" y="155" font-size="9" fill="#b91c1c">Display</text>
          </g>
          
          <defs>
            <marker id="arrow1" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#666"/>
            </marker>
            <marker id="arrow2" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#b91c1c"/>
            </marker>
          </defs>
        </svg>

        <div style="margin-top: 20px; padding: 20px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
          <h4 style="color: #059669; margin-top: 0;"><strong>Request Flow (Green):</strong></h4>
          <p style="margin: 8px 0; color: #374151;">User → Presentation → Application → Domain → Infrastructure</p>
          
          <h4 style="color: #b91c1c; margin-top: 16px;"><strong>Response Flow (Red):</strong></h4>
          <p style="margin: 8px 0; color: #374151;">Infrastructure → Domain → Application → Presentation → User</p>
          
          <h4 style="color: #111; margin-top: 16px;"><strong>Key Points:</strong></h4>
          <ul style="margin: 8px 0; color: #374151;">
            <li>Each layer transforms data for its consumer</li>
            <li>DTOs separate each layer's concerns</li>
            <li>State updates trigger UI re-render automatically</li>
          </ul>
        </div>
      </section>

      <!-- 7. Error Handling Strategy -->
      <section class="card" id="error-strategy">
        <h2>7) Error Handling & Recovery Strategy</h2>
        <p>
          يوضح هذا القسم كيف نتعامل مع الأخطاء على مستويين: <strong>Local MFE Recovery</strong>
          أولاً، ثم <strong>Shell Global Boundary</strong> عند فشل الاستعادة المحلية.
        </p>

        <h3>Error Handling & Recovery Flow</h3>
        <svg viewBox="0 0 1000 520" style="width: 100%; max-width: 100%; height: auto; border: 1px solid #e5e7eb; border-radius: 8px; margin: 20px 0;">
          <defs>
            <marker id="errArrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#059669"/>
            </marker>
            <marker id="errArrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#b91c1c"/>
            </marker>
            <marker id="errArrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#1d4ed8"/>
            </marker>
            <marker id="errArrowAmber" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
              <polygon points="0 0, 10 3, 0 6" fill="#b45309"/>
            </marker>
          </defs>

          <rect x="20" y="20" width="960" height="480" fill="#fcfcfd" stroke="#d1d5db" stroke-width="1.5" rx="10"/>

          <rect x="40" y="55" width="270" height="420" fill="#f0fdf4" stroke="#059669" stroke-width="1.5" rx="8"/>
          <text x="175" y="82" font-size="13" font-weight="bold" text-anchor="middle" fill="#047857">Client + MFE</text>

          <rect x="365" y="55" width="270" height="420" fill="#eff6ff" stroke="#1d4ed8" stroke-width="1.5" rx="8"/>
          <text x="500" y="82" font-size="13" font-weight="bold" text-anchor="middle" fill="#1d4ed8">Shell Boundary</text>

          <rect x="690" y="55" width="270" height="420" fill="#fff7ed" stroke="#b45309" stroke-width="1.5" rx="8"/>
          <text x="825" y="82" font-size="13" font-weight="bold" text-anchor="middle" fill="#b45309">Platform Ops</text>

          <rect x="70" y="110" width="210" height="58" fill="#dcfce7" stroke="#059669" stroke-width="1.5" rx="6"/>
          <text x="175" y="134" font-size="11" font-weight="bold" text-anchor="middle" fill="#065f46">User Action / API Call</text>
          <text x="175" y="152" font-size="10" text-anchor="middle" fill="#4b5563">normal flow starts</text>

          <polygon points="175,210 225,245 175,280 125,245" fill="#fef3c7" stroke="#b45309" stroke-width="1.5"/>
          <text x="175" y="247" font-size="10" font-weight="bold" text-anchor="middle" fill="#92400e">Error?</text>

          <rect x="70" y="320" width="210" height="65" fill="#fee2e2" stroke="#b91c1c" stroke-width="1.5" rx="6"/>
          <text x="175" y="345" font-size="11" font-weight="bold" text-anchor="middle" fill="#991b1b">Local Error Handler</text>
          <text x="175" y="363" font-size="10" text-anchor="middle" fill="#4b5563">capture + classify + sanitize</text>

          <rect x="395" y="125" width="210" height="65" fill="#dbeafe" stroke="#1d4ed8" stroke-width="1.5" rx="6"/>
          <text x="500" y="150" font-size="11" font-weight="bold" text-anchor="middle" fill="#1e3a8a">Global Error Boundary</text>
          <text x="500" y="168" font-size="10" text-anchor="middle" fill="#4b5563">protect shell frame</text>

          <rect x="395" y="230" width="210" height="65" fill="#fef2f2" stroke="#b91c1c" stroke-width="1.5" rx="6"/>
          <text x="500" y="255" font-size="11" font-weight="bold" text-anchor="middle" fill="#991b1b">Fallback UI</text>
          <text x="500" y="273" font-size="10" text-anchor="middle" fill="#4b5563">retry | support info | safe message</text>

          <rect x="395" y="335" width="210" height="65" fill="#dcfce7" stroke="#059669" stroke-width="1.5" rx="6"/>
          <text x="500" y="360" font-size="11" font-weight="bold" text-anchor="middle" fill="#065f46">Recovery Success</text>
          <text x="500" y="378" font-size="10" text-anchor="middle" fill="#4b5563">remount module + continue workflow</text>

          <rect x="720" y="125" width="210" height="65" fill="#dbeafe" stroke="#1d4ed8" stroke-width="1.5" rx="6"/>
          <text x="825" y="150" font-size="11" font-weight="bold" text-anchor="middle" fill="#1e3a8a">Telemetry Event</text>
          <text x="825" y="168" font-size="10" text-anchor="middle" fill="#4b5563">correlationId + module + severity</text>

          <rect x="720" y="230" width="210" height="65" fill="#ffedd5" stroke="#c2410c" stroke-width="1.5" rx="6"/>
          <text x="825" y="255" font-size="11" font-weight="bold" text-anchor="middle" fill="#9a3412">Ops Alert (critical)</text>
          <text x="825" y="273" font-size="10" text-anchor="middle" fill="#4b5563">notify on-call / incident channel</text>

          <rect x="720" y="335" width="210" height="65" fill="#e0e7ff" stroke="#4338ca" stroke-width="1.5" rx="6"/>
          <text x="825" y="360" font-size="11" font-weight="bold" text-anchor="middle" fill="#3730a3">Postmortem Input</text>
          <text x="825" y="378" font-size="10" text-anchor="middle" fill="#4b5563">root cause + preventive action</text>

          <line x1="175" y1="168" x2="175" y2="205" stroke="#059669" stroke-width="2" marker-end="url(#errArrowGreen)"/>
          <line x1="225" y1="245" x2="395" y2="157" stroke="#059669" stroke-width="2" marker-end="url(#errArrowGreen)"/>
          <text x="286" y="210" font-size="9" fill="#059669">No error</text>

          <line x1="175" y1="280" x2="175" y2="320" stroke="#b91c1c" stroke-width="2" marker-end="url(#errArrowRed)"/>
          <text x="188" y="303" font-size="9" fill="#b91c1c">Yes</text>

          <line x1="280" y1="352" x2="395" y2="262" stroke="#b91c1c" stroke-width="2" marker-end="url(#errArrowRed)"/>
          <text x="320" y="315" font-size="9" fill="#b91c1c">not recoverable</text>

          <line x1="175" y1="385" x2="175" y2="440" stroke="#b45309" stroke-width="2" marker-end="url(#errArrowAmber)"/>
          <path d="M 175 440 L 335 440 L 335 368 L 395 368" stroke="#b45309" stroke-width="2" fill="none" marker-end="url(#errArrowAmber)"/>
          <text x="235" y="432" font-size="9" fill="#b45309">retry succeeds</text>

          <line x1="605" y1="157" x2="720" y2="157" stroke="#1d4ed8" stroke-width="2" marker-end="url(#errArrowBlue)"/>
          <line x1="605" y1="262" x2="720" y2="262" stroke="#1d4ed8" stroke-width="2" marker-end="url(#errArrowBlue)"/>
          <line x1="605" y1="368" x2="720" y2="368" stroke="#1d4ed8" stroke-width="2" marker-end="url(#errArrowBlue)"/>
        </svg>

        <div class="grid-2" style="margin-top: 16px;">
          <div class="box">
            <h4>Recovery Levels</h4>
            <ul>
              <li><strong>Level 1 (Local):</strong> retry transient failures داخل MFE</li>
              <li><strong>Level 2 (Shell):</strong> isolate module failure with fallback</li>
              <li><strong>Level 3 (Ops):</strong> alert on repeated/critical errors</li>
              <li><strong>Level 4 (Learning):</strong> postmortem + fix prevention</li>
            </ul>
          </div>
          <div class="box">
            <h4>Implementation Contract</h4>
            <ul>
              <li>Never crash Shell بسبب خطأ في Module واحد</li>
              <li>Always emit telemetry with correlationId</li>
              <li>Show safe user message without internal stack traces</li>
              <li>Support deterministic retry/remount action</li>
            </ul>
          </div>
        </div>

        <div class="highlight">
          <strong>Outcome:</strong> المنصة تظل مستقرة حتى عند فشل وحدة، مع مسار Recovery واضح
          من Local Handling إلى Shell Isolation ثم Ops Visibility.
        </div>
      </section>

      <!-- 8. Best Practices & Common Patterns -->
      <section class="card" id="best-practices">
        <h2>8) Best Practices & Implementation Patterns</h2>
        
        <h3>8.1) Module Manifest Best Practice</h3>
        <pre style="background: #f3f4f6; padding: 12px; border-radius: 8px; direction: ltr; text-align: left;">// Module Manifest Example
const moduleName = 'inventory-module';
export const InventoryModuleManifest = {
  id: 'mfe-inventory',
  name: 'Inventory Management',
  description: 'Stock, Warehouse, Transfer Management',
  baseRoute: '/inventory',
  version: '1.0.0',
  permissions: ['inventory.view', 'inventory.edit'],
  icon: 'package',
  // Mount point function - Shell calls this
  mount: (hostContext, container) => {
    // hostContext: { user, tenant, language, theme, telemetry }
    // container: DOM element where MFE will render
    ReactDOM.createRoot(container).render(
      &lt;InventoryApp hostContext={hostContext} /&gt;
    );
  },
  // Lifecycle unmount
  unmount: () => {
    // Cleanup resources before MFE is removed
  }
};
        </pre>
        
        <h3>8.2) Repository Pattern (Infrastructure Layer)</h3>
        <pre style="background: #f3f4f6; padding: 12px; border-radius: 8px; direction: ltr; text-align: left;">// Domain Contract (Domain Layer)
export interface ItemRepository {
  getItems(filters: ItemFilterDTO): Promise&lt;Item[]&gt;;
  createItem(item: CreateItemDTO): Promise&lt;Item&gt;;
  updateItem(id: string, item: UpdateItemDTO): Promise&lt;Item&gt;;
}

// Implementation (Infrastructure Layer)
export class ApiItemRepository implements ItemRepository {
  constructor(private http: HttpClient) {}
  
  async getItems(filters: ItemFilterDTO): Promise&lt;Item[]&gt; {
    const response = await this.http.get&lt;ItemDTOResponse[]&gt;(
      '/api/inventory/items', 
      { params: filters }
    );
    return response.map(dto => ItemMapper.toDomain(dto));
  }
}

// Domain Service (Domain Layer - independent of HTTP)
export class ItemUseCase {
  constructor(private repository: ItemRepository) {}
  
  async searchItems(query: string): Promise&lt;Item[]&gt; {
    const items = await this.repository.getItems({ search: query });
    return items.filter(item =&gt; item.isActive);
  }
}
        </pre>
        
        <h3>8.3) DTO Mapping Pattern</h3>
        <pre style="background: #f3f4f6; padding: 12px; border-radius: 8px; direction: ltr; text-align: left;">// DTOs layer - separate concern
export interface ItemDTO {
  id: string;
  name: string;
  sku: string;
  quantity: number;
  warehouseId: string;
  lastUpdated: string;
}

// Mapper (Infrastructure) - transforms DTO ↔ Domain Entity
export class ItemMapper {
  static toDomain(dto: ItemDTO): Item {
    return new Item(
      dto.id,
      dto.name,
      dto.sku,
      new Quantity(dto.quantity), // Value Object
      new WarehouseReference(dto.warehouseId)
    );
  }
  
  static toDTO(item: Item): ItemDTO {
    return {
      id: item.id,
      name: item.name,
      sku: item.sku,
      quantity: item.quantity.value,
      warehouseId: item.warehouse.id,
      lastUpdated: new Date().toISOString()
    };
  }
}

// ViewModel Mapper (Presentation) - for UI display
export class ItemViewModelMapper {
  static toViewModel(item: Item): ItemViewModel {
    return {
      id: item.id,
      displayName: `${item.name} (${item.sku})`,
      availableQty: item.quantity.value,
      statusBadge: item.isLowStock ? 'warning' : 'success',
      warehouseLabel: item.warehouse.name
    };
  }
}
        </pre>
        
        <h3>8.4) Avoiding Cross-MFE Dependencies</h3>
        <div class="highlight warning" style="border-right: 4px solid #ef6444; background: #fef2f2; border-radius: 8px; padding: 12px 14px; margin: 10px 0; text-align: right;">
          <strong style="color: #c4161c">❌ Wrong Approach:</strong>
          <pre style="background: #fff; padding: 8px; border-radius: 4px; margin: 8px 0; direction: ltr; text-align: left; font-size: 12px;">
// MFE-Sales importing from MFE-Inventory (Tight Coupling)
import { InventoryService } from '@mfe-inventory/application';

// This creates runtime coupling and deployment complexity
          </pre>
        </div>
        
        <div class="highlight" style="border-right: 4px solid #0f766e; background: #ecfdf5; border-radius: 8px; padding: 12px 14px; margin: 10px 0; text-align: right;">
          <strong style="color: #0f766e">✓ Correct Approach:</strong>
          <pre style="background: #fff; padding: 8px; border-radius: 4px; margin: 8px 0; direction: ltr; text-align: left; font-size: 12px;">
// Use shared Services layer (through Shell Context)
// or API-based communication
const inventoryService = useShellService('inventory');
const items = await inventoryService.getItems();

// Each MFE is independent, shareable via APIs
          </pre>
        </div>
        
        <h3>8.5) Telemetry & Monitoring</h3>
        <pre style="background: #f3f4f6; padding: 12px; border-radius: 8px; direction: ltr; text-align: left;">// Application Service with Telemetry
export class CreateItemService {
  constructor(
    private repository: ItemRepository,
    private telemetry: TelemetryService
  ) {}
  
  async execute(command: CreateItemCommand): Promise&lt;Item&gt; {
    const startTime = performance.now();
    const correlationId = this.telemetry.generateCorrelationId();
    
    try {
      this.telemetry.trackEvent('ItemCreation.Started', { 
        correlationId, 
        moduleId: 'mfe-inventory' 
      });
      
      const item = await this.repository.createItem(command.toDTO());
      
      const duration = performance.now() - startTime;
      this.telemetry.trackEvent('ItemCreation.Success', { 
        correlationId, 
        duration,
        itemId: item.id 
      });
      
      return item;
    } catch (error) {
      this.telemetry.trackError('ItemCreation.Failed', {
        correlationId,
        errorCode: error.code,
        errorMessage: error.message
      });
      throw error;
    }
  }
}
        </pre>
      </section>

      <!-- 9. Performance & Optimization -->
      <section class="card" id="performance">
        <h2>9) Performance Optimization & Scalability</h2>
        
        <h3>9.1) MFE Bundle Optimization</h3>
        <ul>
          <li><strong>Code Splitting:</strong> Split by feature routes (lazy load), not by layers</li>
          <li><strong>Shared Dependencies:</strong> Define shared library versions in Shell</li>
          <li><strong>Bundle Analysis:</strong> Monitor MFE bundle size in CI/CD pipeline</li>
          <li><strong>Tree Shaking:</strong> Use ES6 modules and ensure unused code is removed</li>
          <li><strong>Dynamic Imports:</strong> Use <code>React.lazy()</code> for route-based splitting</li>
        </ul>
        
        <h3>9.2) API Caching Strategy</h3>
        <ul>
          <li><strong>Client-Side Caching:</strong> Use Redux/Zustand cache with TTL</li>
          <li><strong>HTTP Caching:</strong> Leverage browser cache headers (Cache-Control, ETag)</li>
          <li><strong>Query Deduplication:</strong> Prevent duplicate simultaneous requests</li>
          <li><strong>Invalidation Strategy:</strong> Clear cache on user actions (create/update/delete)</li>
          <li><strong>Stale-While-Revalidate:</strong> Serve cached data while fetching fresh data in background</li>
        </ul>
        
        <h3>9.3) State Management Optimization</h3>
        <ul>
          <li><strong>Selector Memoization:</strong> Use <code>reselect</code> to prevent unnecessary re-renders</li>
          <li><strong>Normalized State:</strong> Store entities in normalized form to avoid duplication</li>
          <li><strong>Lazy State:</strong> Only load state needed for current view</li>
          <li><strong>Memory Management:</strong> Clean up state for unmounted components</li>
        </ul>
        
        <h3>9.4) Rendering Performance</h3>
        <ul>
          <li><strong>Memoization:</strong> Use <code>React.memo()</code> for expensive components</li>
          <li><strong>Virtual Scrolling:</strong> For long lists, use windowing libraries</li>
          <li><strong>Debounce/Throttle:</strong> Expensive operations (search, resize handlers)</li>
          <li><strong>Image Optimization:</strong> Use WebP, lazy loading, responsive images</li>
          <li><strong>Web Workers:</strong> Offload heavy computation from main thread</li>
        </ul>
        
        <h3>9.5) MFE Loading Performance</h3>
        <table>
          <thead>
            <tr>
              <th>Optimization</th>
              <th>Impact</th>
              <th>Implementation</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Preload</strong></td>
              <td>Reduce perceived load time</td>
              <td>Prefetch MFE bundle on route hover</td>
            </tr>
            <tr>
              <td><strong>Concurrent Loading</strong></td>
              <td>Better resource utilization</td>
              <td>Load auth + menu + MFE in parallel</td>
            </tr>
            <tr>
              <td><strong>Progressive Enhancement</strong></td>
              <td>Faster First Paint</td>
              <td>Show skeleton screen while loading</td>
            </tr>
            <tr>
              <td><strong>Module Streaming</strong></td>
              <td>Faster initial render</td>
              <td>Start rendering before full bundle loads</td>
            </tr>
            <tr>
              <td><strong>CDN Caching</strong></td>
              <td>Reduced server load</td>
              <td>Cache MFE bundles on edge servers</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Summary -->
      <section class="card">
        <p>
          توفر معمارية Micro-Frontend هذه نهجاً قابلاً للتوسع وسهل الصيانة لبناء منصات ERP
          على نطاق واسع من خلال:
        </p>
        <ul>
          <li>فصل Domain Concerns في Modular Units مع Clear Ownership</li>
          <li>Centralization of Platform Orchestration والخدمات المشتركة في Shell</li>
          <li>Enforcement of Stable Integration Contracts بين Shell و MFEs</li>
          <li>تمكين المرونة من خلال Module Isolation والسلوك البديل</li>
          <li>الحفاظ على Consistent User Experience من خلال Shared Providers و Design Systems</li>
          <li>دعم Independent Development والنشر لـ Domain Modules</li>
        </ul>

        <div class="highlight">
          <strong>Key Success Factors:</strong> Clear Boundary Enforcement، Stable Contracts، Shared Standards، والاتصال المتسق بين Platform Layers.
        </div>
      </section>
    </main>
  </body>
</html>
